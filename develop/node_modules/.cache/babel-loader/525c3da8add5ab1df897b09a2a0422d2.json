{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";\nimport _classCallCheck from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";\nvar _jsxFileName = \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\src\\\\components\\\\profile\\\\DeleteAccount.js\";\nimport React from \"react\";\nimport { Button, Card, CardHeader, Col, Form, ListGroup, ListGroupItem, Row, Tooltip } from \"shards-react\";\nimport { languageCode, parentsParameters, showToast, studentsParameters, toastTypes } from \"../../utils/general_utils\";\nimport { deleteAccountSectionTitle } from \"../../utils/page_titles_strings\";\nimport { confirmDeleteAccount, confirmLogoutAfterDelete, daysToDeleteRegistTipMessage, deleteAccountDisabledTipMessage, deleteAccountExplanation, deleteAccountGenericErrorMsg, deleteAccountSuccess } from \"../../utils/messages_strings\";\nimport { deleteAccountPrompt, erase } from \"../../utils/common_strings\";\nimport { deleteAccount, deleteAccountEmailNotification, userLogOut } from \"../../firebase_scripts/profile_functions\";\nimport ConfirmationDialog from \"../dialog/ConfirmationDialog\";\nimport AknowledgementDialog from \"../dialog/AknowledgementDialog\";\nimport { storage } from \"../../firebase-config\";\n\nvar DeleteAccount = /*#__PURE__*/function (_React$Component) {\n  _inherits(DeleteAccount, _React$Component);\n\n  var _super = _createSuper(DeleteAccount);\n\n  function DeleteAccount(props) {\n    var _this;\n\n    _classCallCheck(this, DeleteAccount);\n\n    _this = _super.call(this, props);\n    var parent = null;\n    var infoFormTitle = deleteAccountSectionTitle[languageCode];\n\n    if (_this.props.user != null) {\n      parent = _this.props.user;\n    }\n\n    _this.state = {\n      title: infoFormTitle,\n      parent: parent,\n      dialogOpen: false,\n      deleteAccountDialogOpen: false,\n      deleteDisabledToggle: false\n    };\n    _this.deleteUserAccount = _this.deleteUserAccount.bind(_assertThisInitialized(_this));\n    _this.finnishDeleteAccountFlow = _this.finnishDeleteAccountFlow.bind(_assertThisInitialized(_this));\n    _this.deleteParentAndChildrenPhotos = _this.deleteParentAndChildrenPhotos.bind(_assertThisInitialized(_this));\n    _this.deletePhoto = _this.deletePhoto.bind(_assertThisInitialized(_this));\n    _this.closeDialog = _this.closeDialog.bind(_assertThisInitialized(_this));\n    _this.openDialog = _this.openDialog.bind(_assertThisInitialized(_this));\n    _this.closeSuccessDialog = _this.closeSuccessDialog.bind(_assertThisInitialized(_this));\n    _this.openSuccessDialog = _this.openSuccessDialog.bind(_assertThisInitialized(_this));\n    _this.toggle = _this.toggle.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n  /*********************************** LIFECYCLE ***********************************/\n\n\n  _createClass(DeleteAccount, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this._isMounted = true;\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this._isMounted = false;\n    }\n    /*********************************** HANDLERS ***********************************/\n\n  }, {\n    key: \"toggle\",\n    value: function toggle(pos) {\n      var newState = {};\n      newState[pos] = !this.state[pos];\n      this.setState(_objectSpread({}, this.state, {}, newState));\n    }\n  }, {\n    key: \"deleteUserAccount\",\n    value: function deleteUserAccount(confirmation) {\n      console.log(\"result dialog: \" + confirmation);\n      var this_ = this;\n      this_.closeDialog();\n      var email = this_.state.parent[parentsParameters.EMAIL[languageCode]];\n      var nome = this_.state.parent[parentsParameters.NAME[languageCode]];\n      console.log(\"email da conta a eliminar -> \" + email);\n\n      if (confirmation) {\n        deleteAccount(email).then(function (result) {\n          if (result.error == null) {\n            var upParentString = JSON.stringify(result);\n            console.log(\"deletedParent recebido depois do delete email -> \" + upParentString);\n            this_.deleteParentAndChildrenPhotos();\n            this_.openSuccessDialog();\n            deleteAccountEmailNotification(nome, email).then();\n          } else {\n            console.log(\"result error: \" + JSON.stringify(result));\n            showToast(deleteAccountGenericErrorMsg[languageCode], 6000, toastTypes.ERROR);\n          }\n        }).catch(function (error) {\n          if (Object.keys(error).length !== 0) {\n            console.log(\"update error: \" + JSON.stringify(error));\n            showToast(deleteAccountGenericErrorMsg[languageCode], 6000, toastTypes.ERROR);\n          }\n        });\n      } else {//this_.closeDialog();\n      }\n    }\n  }, {\n    key: \"finnishDeleteAccountFlow\",\n    value: function finnishDeleteAccountFlow() {\n      userLogOut();\n    }\n  }, {\n    key: \"closeDialog\",\n    value: function closeDialog() {\n      this.setState({\n        dialogOpen: false\n      });\n    }\n  }, {\n    key: \"openDialog\",\n    value: function openDialog() {\n      this.setState({\n        dialogOpen: true\n      });\n    }\n  }, {\n    key: \"closeSuccessDialog\",\n    value: function closeSuccessDialog() {\n      //alert(\"close success\");\n      this.setState({\n        deleteAccountDialogOpen: false\n      });\n    }\n  }, {\n    key: \"openSuccessDialog\",\n    value: function openSuccessDialog() {\n      //alert(\"abrir success\");\n      this.setState({\n        deleteAccountDialogOpen: true\n      });\n    }\n  }, {\n    key: \"deletePhoto\",\n    value: function () {\n      var _deletePhoto = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(photoURL) {\n        var photoRef;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                // delete parent photo\n                try {\n                  photoRef = storage.refFromURL(photoURL.toString());\n                  photoRef.delete().then(function () {\n                    console.log(\"foto < \" + photoURL + \" > eliminada com sucesso.\");\n                  }).catch(function () {\n                    console.log(\"erro a eliminar a foto < \" + photoURL + \" >\");\n                  });\n                } catch (e) {\n                  // nothing\n                  console.log(\"NO PHOTO! < \" + photoURL + \" > -> \" + JSON.stringify(e));\n                }\n\n              case 1:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function deletePhoto(_x) {\n        return _deletePhoto.apply(this, arguments);\n      }\n\n      return deletePhoto;\n    }()\n  }, {\n    key: \"deleteParentAndChildrenPhotos\",\n    value: function deleteParentAndChildrenPhotos() {\n      var profilePhoto = this.state.parent[parentsParameters.PHOTO[languageCode]];\n      var children = this.state.parent[parentsParameters.CHILDREN[languageCode]];\n      var childrenPhotos = children.map(function (child) {\n        var final = [];\n        final.push(child[studentsParameters.PHOTO[languageCode]]);\n        return final;\n      }); // delete parent photo\n\n      this.deletePhoto(profilePhoto).then(function (r) {}); // delete children photos\n\n      for (var i in childrenPhotos) {\n        var photo = childrenPhotos[i];\n        this.deletePhoto(photo).then(function (r) {});\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return /*#__PURE__*/React.createElement(Card, {\n        small: true,\n        className: \"mb-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(CardHeader, {\n        className: \"border-bottom bg-danger\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"h6\", {\n        className: \"m-0 text-white\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 11\n        }\n      }, this.state.title)), /*#__PURE__*/React.createElement(ListGroup, {\n        flush: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(ListGroupItem, {\n        className: \"p-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(Row, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 197,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(Col, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 198,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(Form, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(Row, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 200,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(Col, {\n        md: \"12\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 23\n        }\n      }, deleteAccountExplanation[languageCode]))), /*#__PURE__*/React.createElement(\"hr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 19\n        }\n      }), /*#__PURE__*/React.createElement(Row, {\n        style: {\n          marginLeft: \"5px\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 208,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        theme: \"danger\",\n        onClick: this.openDialog,\n        disabled: this.state.parent[parentsParameters.ADMIN[languageCode]],\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 209,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        className: \"material-icons md-24\",\n        style: {\n          fontSize: \"150%\",\n          textAlign: \"center\",\n          verticalAlign: \"middle\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 213,\n          columnNumber: 23\n        }\n      }, \"delete\"), erase[languageCode]), this.state.parent[parentsParameters.ADMIN[languageCode]] ? /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          marginLeft: \"20px\",\n          marginTop: \"5px\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 217,\n          columnNumber: 23\n        }\n      }, \" \", /*#__PURE__*/React.createElement(\"span\", {\n        id: \"deleteDisabledTooltip\",\n        className: \"material-icons\",\n        style: {\n          fontSize: \"130 %\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 217,\n          columnNumber: 76\n        }\n      }, \"info\"), \" \") : null, this.state.parent[parentsParameters.ADMIN[languageCode]] ? /*#__PURE__*/React.createElement(Tooltip, {\n        open: this.state.deleteDisabledToggle,\n        target: \"#deleteDisabledTooltip\",\n        toggle: function toggle() {\n          return _this2.toggle(\"deleteDisabledToggle\");\n        },\n        style: {\n          fontSize: \"120%\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 23\n        }\n      }, deleteAccountDisabledTipMessage[languageCode]) : null)))))), this.state.dialogOpen ? /*#__PURE__*/React.createElement(ConfirmationDialog, {\n        open: this.state.dialogOpen,\n        result: this.deleteUserAccount,\n        title: deleteAccountPrompt[languageCode],\n        message: confirmDeleteAccount[languageCode],\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 236,\n          columnNumber: 11\n        }\n      }) : null, this.state.deleteAccountDialogOpen ? /*#__PURE__*/React.createElement(AknowledgementDialog, {\n        open: this.state.deleteAccountDialogOpen,\n        after: this.finnishDeleteAccountFlow,\n        title: deleteAccountSuccess[languageCode],\n        message: confirmLogoutAfterDelete[languageCode],\n        parent: this,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 244,\n          columnNumber: 11\n        }\n      }) : null);\n    }\n  }]);\n\n  return DeleteAccount;\n}(React.Component);\n\nexport default DeleteAccount;","map":{"version":3,"sources":["C:/Users/User/Desktop/Ambiente de Trabalho/Universidade/Ano 3/Semestre 2/PI/Projeto/repos/pi-assoc-pais/develop/src/components/profile/DeleteAccount.js"],"names":["React","Button","Card","CardHeader","Col","Form","ListGroup","ListGroupItem","Row","Tooltip","languageCode","parentsParameters","showToast","studentsParameters","toastTypes","deleteAccountSectionTitle","confirmDeleteAccount","confirmLogoutAfterDelete","daysToDeleteRegistTipMessage","deleteAccountDisabledTipMessage","deleteAccountExplanation","deleteAccountGenericErrorMsg","deleteAccountSuccess","deleteAccountPrompt","erase","deleteAccount","deleteAccountEmailNotification","userLogOut","ConfirmationDialog","AknowledgementDialog","storage","DeleteAccount","props","parent","infoFormTitle","user","state","title","dialogOpen","deleteAccountDialogOpen","deleteDisabledToggle","deleteUserAccount","bind","finnishDeleteAccountFlow","deleteParentAndChildrenPhotos","deletePhoto","closeDialog","openDialog","closeSuccessDialog","openSuccessDialog","toggle","_isMounted","pos","newState","setState","confirmation","console","log","this_","email","EMAIL","nome","NAME","then","result","error","upParentString","JSON","stringify","ERROR","catch","Object","keys","length","photoURL","photoRef","refFromURL","toString","delete","e","profilePhoto","PHOTO","children","CHILDREN","childrenPhotos","map","child","final","push","r","i","photo","marginLeft","ADMIN","fontSize","textAlign","verticalAlign","marginTop","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport {\r\n  Button,\r\n  Card,\r\n  CardHeader,\r\n  Col,\r\n  Form,\r\n  ListGroup,\r\n  ListGroupItem,\r\n  Row, Tooltip\r\n} from \"shards-react\";\r\nimport {\r\n  languageCode, parentsParameters, showToast, studentsParameters, toastTypes\r\n} from \"../../utils/general_utils\";\r\nimport {\r\n  deleteAccountSectionTitle\r\n} from \"../../utils/page_titles_strings\";\r\nimport {\r\n  confirmDeleteAccount,\r\n  confirmLogoutAfterDelete,\r\n  daysToDeleteRegistTipMessage,\r\n  deleteAccountDisabledTipMessage,\r\n  deleteAccountExplanation,\r\n  deleteAccountGenericErrorMsg,\r\n  deleteAccountSuccess\r\n} from \"../../utils/messages_strings\";\r\nimport {\r\n  deleteAccountPrompt,\r\n  erase\r\n} from \"../../utils/common_strings\";\r\nimport {\r\n  deleteAccount, deleteAccountEmailNotification,\r\n  userLogOut\r\n} from \"../../firebase_scripts/profile_functions\";\r\nimport ConfirmationDialog from \"../dialog/ConfirmationDialog\";\r\nimport AknowledgementDialog from \"../dialog/AknowledgementDialog\";\r\nimport {storage} from \"../../firebase-config\";\r\n\r\n\r\nclass DeleteAccount extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    let parent = null;\r\n    const infoFormTitle = deleteAccountSectionTitle[languageCode];\r\n\r\n    if(this.props.user!=null){\r\n      parent = this.props.user;\r\n    }\r\n\r\n    this.state = {\r\n      title: infoFormTitle,\r\n      parent : parent,\r\n      dialogOpen : false,\r\n      deleteAccountDialogOpen : false,\r\n      deleteDisabledToggle: false,\r\n    };\r\n\r\n    this.deleteUserAccount = this.deleteUserAccount.bind(this);\r\n    this.finnishDeleteAccountFlow = this.finnishDeleteAccountFlow.bind(this);\r\n    this.deleteParentAndChildrenPhotos = this.deleteParentAndChildrenPhotos.bind(this);\r\n    this.deletePhoto = this.deletePhoto.bind(this);\r\n\r\n    this.closeDialog = this.closeDialog.bind(this);\r\n    this.openDialog = this.openDialog.bind(this);\r\n    this.closeSuccessDialog = this.closeSuccessDialog.bind(this);\r\n    this.openSuccessDialog = this.openSuccessDialog.bind(this);\r\n    this.toggle = this.toggle.bind(this);\r\n\r\n  }\r\n\r\n  /*********************************** LIFECYCLE ***********************************/\r\n  componentDidMount() {\r\n    this._isMounted = true;\r\n\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this._isMounted = false;\r\n  }\r\n\r\n  /*********************************** HANDLERS ***********************************/\r\n\r\n  toggle(pos) {\r\n    const newState = {};\r\n    newState[pos] = !this.state[pos];\r\n    this.setState({ ...this.state, ...newState });\r\n  }\r\n\r\n  deleteUserAccount(confirmation){\r\n    console.log(\"result dialog: \" + confirmation);\r\n    const this_ = this;\r\n    this_.closeDialog();\r\n\r\n    const email = this_.state.parent[parentsParameters.EMAIL[languageCode]];\r\n    const nome = this_.state.parent[parentsParameters.NAME[languageCode]];\r\n    console.log(\"email da conta a eliminar -> \" + email);\r\n\r\n    if(confirmation){\r\n      deleteAccount(email)\r\n        .then((result) => {\r\n          if(result.error==null){\r\n            const upParentString = JSON.stringify(result);\r\n            console.log(\"deletedParent recebido depois do delete email -> \" + upParentString);\r\n            this_.deleteParentAndChildrenPhotos();\r\n            this_.openSuccessDialog();\r\n            deleteAccountEmailNotification(nome, email).then();\r\n          }\r\n          else{\r\n            console.log(\"result error: \" + JSON.stringify(result));\r\n            showToast(deleteAccountGenericErrorMsg[languageCode], 6000, toastTypes.ERROR);\r\n          }\r\n        })\r\n        .catch((error) => {\r\n          if(Object.keys(error).length!==0){\r\n            console.log(\"update error: \" + JSON.stringify(error));\r\n            showToast(deleteAccountGenericErrorMsg[languageCode], 6000, toastTypes.ERROR);\r\n          }\r\n        });\r\n\r\n    }\r\n    else{\r\n      //this_.closeDialog();\r\n    }\r\n  }\r\n\r\n\r\n  finnishDeleteAccountFlow(){\r\n    userLogOut();\r\n  }\r\n\r\n  closeDialog() {\r\n    this.setState({dialogOpen : false});\r\n  }\r\n\r\n  openDialog() {\r\n    this.setState({dialogOpen : true});\r\n  }\r\n\r\n  closeSuccessDialog() {\r\n    //alert(\"close success\");\r\n    this.setState({deleteAccountDialogOpen : false});\r\n  }\r\n\r\n  openSuccessDialog() {\r\n    //alert(\"abrir success\");\r\n    this.setState({deleteAccountDialogOpen : true});\r\n  }\r\n\r\n  async deletePhoto(photoURL){\r\n    // delete parent photo\r\n    try {\r\n      let photoRef = storage.refFromURL(photoURL.toString());\r\n      photoRef.delete()\r\n        .then(() => {\r\n          console.log(\"foto < \" + photoURL + \" > eliminada com sucesso.\");\r\n        })\r\n        .catch(() => {\r\n          console.log(\"erro a eliminar a foto < \" + photoURL + \" >\");\r\n        });\r\n    }\r\n    catch (e) {\r\n      // nothing\r\n      console.log(\"NO PHOTO! < \" + photoURL + \" > -> \" + JSON.stringify(e));\r\n    }\r\n  }\r\n\r\n  deleteParentAndChildrenPhotos(){\r\n    const profilePhoto = this.state.parent[parentsParameters.PHOTO[languageCode]];\r\n    const children = this.state.parent[parentsParameters.CHILDREN[languageCode]];\r\n\r\n    const childrenPhotos = children.map((child) => {\r\n      const final = [];\r\n      final.push(child[studentsParameters.PHOTO[languageCode]]);\r\n      return final;\r\n    });\r\n\r\n    // delete parent photo\r\n    this.deletePhoto(profilePhoto).then(r => {});\r\n\r\n    // delete children photos\r\n    for(const i in childrenPhotos){\r\n      const photo = childrenPhotos[i];\r\n      this.deletePhoto(photo).then(r => {});\r\n    }\r\n  }\r\n\r\n\r\n  render() {\r\n    return (\r\n      <Card small className=\"mb-4\" >\r\n        <CardHeader className=\"border-bottom bg-danger\">\r\n          <h6 className=\"m-0 text-white\">{this.state.title}</h6>\r\n        </CardHeader>\r\n        <ListGroup flush>\r\n          <ListGroupItem className=\"p-3\">\r\n            <Row>\r\n              <Col>\r\n                <Form>\r\n                  <Row>\r\n                    <Col md=\"12\">\r\n                      <p>\r\n                        {deleteAccountExplanation[languageCode]}\r\n                      </p>\r\n                    </Col>\r\n                  </Row>\r\n                  <hr />\r\n                  <Row style={{marginLeft: \"5px\"}}>\r\n                    <Button\r\n                      theme=\"danger\"\r\n                      onClick={this.openDialog}\r\n                      disabled={this.state.parent[parentsParameters.ADMIN[languageCode]]}>\r\n                      <span className=\"material-icons md-24\" style={{fontSize:\"150%\", textAlign: \"center\", verticalAlign:\"middle\"}}>delete</span>\r\n                      {erase[languageCode]}\r\n                    </Button>\r\n                    {this.state.parent[parentsParameters.ADMIN[languageCode]] ?\r\n                      <div style={{marginLeft: \"20px\", marginTop: \"5px\"}}> <span id=\"deleteDisabledTooltip\" className=\"material-icons\" style={{fontSize:\"130 %\"}}>info</span> </div> : null}\r\n                    {this.state.parent[parentsParameters.ADMIN[languageCode]] ?\r\n                      <Tooltip\r\n                        open={this.state.deleteDisabledToggle}\r\n                        target=\"#deleteDisabledTooltip\"\r\n                        toggle={() => this.toggle(\"deleteDisabledToggle\")}\r\n                        style={{fontSize:\"120%\"}}\r\n                      >\r\n                        {deleteAccountDisabledTipMessage[languageCode]}\r\n                      </Tooltip> : null}\r\n                  </Row>\r\n\r\n                </Form>\r\n              </Col>\r\n            </Row>\r\n          </ListGroupItem>\r\n        </ListGroup>\r\n\r\n        {this.state.dialogOpen ?\r\n          <ConfirmationDialog\r\n            open={this.state.dialogOpen}\r\n            result={this.deleteUserAccount}\r\n            title={deleteAccountPrompt[languageCode]}\r\n            message={confirmDeleteAccount[languageCode]}/>\r\n          : null}\r\n\r\n        {this.state.deleteAccountDialogOpen ?\r\n          <AknowledgementDialog\r\n            open={this.state.deleteAccountDialogOpen}\r\n            after={this.finnishDeleteAccountFlow}\r\n            title={deleteAccountSuccess[languageCode]}\r\n            message={confirmLogoutAfterDelete[languageCode]}\r\n            parent={this}/>\r\n          : null}\r\n\r\n      </Card>\r\n\r\n    );\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n\r\nexport default DeleteAccount;\r\n"]},"metadata":{},"sourceType":"module"}