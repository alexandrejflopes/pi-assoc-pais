{"ast":null,"code":"import _objectSpread from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";\nimport _regeneratorRuntime from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";\nvar _jsxFileName = \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\src\\\\components\\\\cargos-page\\\\CargosModal.js\";\n\n/* eslint jsx-a11y/anchor-is-valid: 0 */\nimport React, { Fragment, useState } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport Modal from \"react-bootstrap/Modal\";\nimport { Redirect } from \"react-router\";\nimport { ListGroup, ListGroupItem, Button, Col, Form, FormGroup, FormInput, FormFeedback, FormTextarea, FormCheckbox, FormSelect } from \"shards-react\";\nimport { languageCode, parentsParameters, showToast, toastTypes, saveButton, closeButton, newCargoTransactionButton, newCargosTitle, newCargosHeaderName, newCargosHeaderEmail, newCargosHeaderCargoAtual, newCargosHeaderNovoCargo, cargosSemCargo, cargosSemMudanca } from \"../../utils/general_utils\";\nimport * as moment from \"moment\";\nimport { Multiselect } from \"multiselect-react-dropdown\";\nimport { addCasoError, sucessoGeral, cargosGetError, cargosNothingToUpdateWarning, cargosUpdateError, erroCargosRepetidos, loadingInfo, erroCargosAdminEmFalta } from \"../../utils/messages_strings\";\nimport { firestore, firebase_auth, firebase, firebaseConfig } from \"../../firebase-config\";\nimport { toast, Bounce } from \"react-toastify\";\nimport { saveCaseToDB } from \"../../firebase_scripts/installation\";\nimport { loading } from \"../../utils/common_strings\";\n\nvar CargosModal = /*#__PURE__*/function (_React$Component) {\n  _inherits(CargosModal, _React$Component);\n\n  var _super = _createSuper(CargosModal);\n\n  function CargosModal(props) {\n    var _this;\n\n    _classCallCheck(this, CargosModal);\n\n    _this = _super.call(this, props);\n    _this.state = {\n      show: false,\n      admin: false,\n      redirect: null,\n      listaCargos: [],\n      cargosAtuais: {},\n      changes: {},\n      membersComplete: [],\n      membrosSelected: [],\n      options: []\n    };\n    _this.componentDidMount = _this.componentDidMount.bind(_assertThisInitialized(_this));\n    _this.createTransaction = _this.createTransaction.bind(_assertThisInitialized(_this));\n    _this.change = _this.change.bind(_assertThisInitialized(_this));\n    _this.showModal = _this.showModal.bind(_assertThisInitialized(_this));\n    _this.closeModal = _this.closeModal.bind(_assertThisInitialized(_this));\n    _this.loadParents = _this.loadParents.bind(_assertThisInitialized(_this));\n\n    _this.loadParents();\n\n    return _this;\n  }\n\n  _createClass(CargosModal, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var currentUser = JSON.parse(window.localStorage.getItem(\"userDoc\"));\n\n      if (currentUser != null) {\n        var admin_ = currentUser.Admin;\n        this.setState({\n          admin: admin_\n        });\n      } else {\n        //Redirect to login\n        var redirect = /*#__PURE__*/React.createElement(Redirect, {\n          to: {\n            pathname: \"/\"\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 89,\n            columnNumber: 9\n          }\n        });\n        this.setState({\n          redirect: redirect\n        });\n      }\n    }\n  }, {\n    key: \"loadParents\",\n    value: function loadParents() {\n      var _this2 = this;\n\n      var parentsCollection = firestore.collection(\"parents\");\n      parentsCollection.get().then(function (querySnapshot) {\n        var membersArray = [];\n        var membersArrayComplete = [];\n        var options = [];\n        var index = 0;\n        querySnapshot.forEach(function (doc) {\n          if (doc.data()[\"Nome\"] != undefined && doc.data()[\"Nome\"] != null) {\n            if (doc.data()[\"Validated\"] != undefined && doc.data()[\"Validated\"] != null && doc.data()[\"Validated\"].toString() != \"false\") {\n              membersArrayComplete.push({\n                nome: doc.data()[\"Nome\"],\n                id: doc.data()[\"Email\"],\n                photo: doc.data()[\"photo\"]\n              });\n              options.push({\n                id: index,\n                name: doc.data()[\"Nome\"]\n              });\n              index += 1;\n            }\n          }\n        });\n\n        if (options.length != 0) {\n          //console.log(membersArrayComplete);\n          _this2.setState({\n            membersComplete: membersArrayComplete,\n            options: options\n          });\n        }\n      });\n    }\n  }, {\n    key: \"showModal\",\n    value: function showModal() {\n      var project_id = firebaseConfig.projectId;\n      var this_ = this;\n      var uri = \"https://us-central1-\" + project_id + \".cloudfunctions.net/api/getUserCargos\";\n      showToast(loading[languageCode], 2000, toastTypes.INFO);\n\n      var request = /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _context.next = 2;\n                  return fetch(uri).then(function (resp) {\n                    return resp.json();\n                  }) // Transform the data into json\n                  .then(function (data) {\n                    var cargosList = [];\n                    var currentCargosList = {};\n                    var cargos = data.cargos;\n                    var users = data.users;\n                    cargosList.push(cargosSemMudanca[languageCode]);\n\n                    for (var i = 0; i < cargos.length; i++) {\n                      cargosList.push(cargos[i]);\n                    }\n\n                    for (var x = 0; x < users.length; x++) {\n                      var json = users[x];\n                      currentCargosList[json.id] = json.Cargo;\n                    }\n\n                    this_.setState({\n                      listaCargos: cargosList,\n                      cargosAtuais: currentCargosList,\n                      show: true\n                    });\n                  }).catch(function (error) {\n                    showToast(cargosGetError[languageCode], 5000, toastTypes.ERROR);\n                  });\n\n                case 2:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        return function request() {\n          return _ref.apply(this, arguments);\n        };\n      }();\n\n      request();\n    }\n  }, {\n    key: \"closeModal\",\n    value: function closeModal() {\n      this.setState({\n        show: false,\n        membrosSelected: []\n      });\n    }\n  }, {\n    key: \"change\",\n    value: function change(event) {\n      var index = event.target.id;\n      var changes = this.state.changes;\n      changes[index] = event.target.value;\n      this.setState({\n        changes: changes\n      });\n    }\n  }, {\n    key: \"createTransaction\",\n    value: function createTransaction() {\n      var _this$state = this.state,\n          changes = _this$state.changes,\n          membersComplete = _this$state.membersComplete,\n          cargosAtuais = _this$state.cargosAtuais;\n      var this_ = this;\n      var project_id = firebaseConfig.projectId;\n      var tamanho = Object.keys(changes).length;\n      var keys = Object.keys(changes);\n\n      if (tamanho === 0) {\n        showToast(cargosNothingToUpdateWarning[languageCode], 5000, toastTypes.WARNING);\n      } else {\n        var mudanca = false;\n        var listaMembros = [];\n        var data_ = new Date();\n        var data = moment(data_).format(\"DD-MM-YYYY\").toString();\n\n        for (var i = 0; i < tamanho; i++) {\n          if (changes[keys[i]] !== cargosSemMudanca[languageCode] && changes[keys[i]] !== cargosAtuais[membersComplete[keys[i]].id]) {\n            mudanca = true;\n            listaMembros.push({\n              nome: membersComplete[keys[i]].nome,\n              id: membersComplete[keys[i]].id,\n              cargo: changes[keys[i]],\n              data: data\n            });\n          }\n        }\n\n        if (mudanca) {\n          /*\r\n          * FLUXO:\r\n          *   - buscar o userAndCurrentCargos\r\n          *   - modificar (cópia) as linhas correspondentes à lista de membros\r\n          *   - percorrer a cópia e ver se há cargos admin repetidos\r\n          *       - se sim, mensagem a informar e impedir a operação\r\n          * */\n          console.log(\"cargosCollection v\");\n          console.log(this.props.cargosCollection);\n\n          var usersAndNewCargos = _objectSpread({}, this_.state.cargosAtuais); // update local copy to reflect new roles\n\n\n          for (var _i in listaMembros) {\n            var membroJson = listaMembros[_i];\n            var id = membroJson.id;\n            usersAndNewCargos[id] = membroJson.cargo;\n          }\n\n          console.log(\"usersAndNewCargos v\");\n          console.log(usersAndNewCargos);\n          var cargosAnalyzed = [];\n          var cargosRepetidos = false;\n          var numCorretoCargosAdmin = true;\n\n          for (var k in usersAndNewCargos) {\n            var cargo = usersAndNewCargos[k]; // if it's admin role\n\n            if (this.props.cargosCollection[cargo]) {\n              if (cargosAnalyzed.includes(cargo)) {\n                cargosRepetidos = true;\n                break;\n              }\n\n              cargosAnalyzed.push(cargo);\n            }\n          } //cargosAnalyzed should contain every admin role once and only once\n\n\n          if (cargosAnalyzed.length !== this_.props.numberAdminRoles) {\n            numCorretoCargosAdmin = false;\n          }\n\n          console.log(\"cargosAnalyzed -> \" + cargosAnalyzed.toString());\n\n          if (cargosRepetidos) {\n            showToast(erroCargosRepetidos[languageCode], 5000, toastTypes.WARNING);\n          } else if (!numCorretoCargosAdmin) {\n            showToast(erroCargosAdminEmFalta[languageCode], 5000, toastTypes.WARNING);\n          } else {\n            var uri = \"https://us-central1-\" + project_id + \".cloudfunctions.net/api/sendCargoChangeEmail?\" + \"membros=\" + encodeURIComponent(JSON.stringify(listaMembros));\n\n            var request = /*#__PURE__*/function () {\n              var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n                return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                  while (1) {\n                    switch (_context2.prev = _context2.next) {\n                      case 0:\n                        _context2.next = 2;\n                        return fetch(uri).then(function (data) {\n                          showToast(sucessoGeral[languageCode], 5000, toastTypes.SUCCESS);\n                          this_.props.getTransitions();\n                          this_.closeModal();\n                        }).catch(function (error) {\n                          showToast(cargosUpdateError[languageCode], 5000, toastTypes.ERROR);\n                        });\n\n                      case 2:\n                      case \"end\":\n                        return _context2.stop();\n                    }\n                  }\n                }, _callee2);\n              }));\n\n              return function request() {\n                return _ref2.apply(this, arguments);\n              };\n            }();\n\n            request();\n          }\n        } else {\n          showToast(cargosNothingToUpdateWarning[languageCode], 5000, toastTypes.WARNING);\n        }\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      return /*#__PURE__*/React.createElement(React.Fragment, null, this.state.admin ? /*#__PURE__*/React.createElement(Button, {\n        size: \"md\",\n        theme: \"success\",\n        id: \"new_case\",\n        onClick: this.showModal,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 335,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"i\", {\n        className: \"fa fa-plus mr-1\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 341,\n          columnNumber: 13\n        }\n      }), \" \", newCargoTransactionButton[languageCode]) : \"\", this.state.redirect, /*#__PURE__*/React.createElement(Modal, {\n        size: \"lg\",\n        show: this.state.show,\n        onHide: this.closeModal,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 349,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(Modal.Header, {\n        closeButton: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 350,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(Modal.Title, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 351,\n          columnNumber: 13\n        }\n      }, newCargosTitle[languageCode])), /*#__PURE__*/React.createElement(Modal.Body, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 353,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(ListGroup, {\n        flush: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 354,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(ListGroupItem, {\n        className: \"p-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 355,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(Col, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 356,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-striped\",\n        style: {\n          display: \"block\",\n          overflow: \"auto\",\n          whitespace: \"nowrap\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 357,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        className: \"bg-light\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 365,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 366,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        scope: \"col\",\n        className: \"border-0\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 367,\n          columnNumber: 25\n        }\n      }, newCargosHeaderName[languageCode]), /*#__PURE__*/React.createElement(\"th\", {\n        scope: \"col\",\n        className: \"border-0\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 370,\n          columnNumber: 25\n        }\n      }, newCargosHeaderEmail[languageCode]), /*#__PURE__*/React.createElement(\"th\", {\n        scope: \"col\",\n        className: \"border-0\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 373,\n          columnNumber: 25\n        }\n      }, newCargosHeaderCargoAtual[languageCode]), /*#__PURE__*/React.createElement(\"th\", {\n        scope: \"col\",\n        className: \"border-0\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 376,\n          columnNumber: 25\n        }\n      }, newCargosHeaderNovoCargo[languageCode]))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 381,\n          columnNumber: 21\n        }\n      }, this.state.membersComplete.map(function (membro, idx) {\n        return /*#__PURE__*/React.createElement(\"tr\", {\n          __self: _this3,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 383,\n            columnNumber: 25\n          }\n        }, /*#__PURE__*/React.createElement(\"td\", {\n          __self: _this3,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 384,\n            columnNumber: 27\n          }\n        }, membro.nome), /*#__PURE__*/React.createElement(\"td\", {\n          __self: _this3,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 386,\n            columnNumber: 27\n          }\n        }, membro.id), /*#__PURE__*/React.createElement(\"td\", {\n          __self: _this3,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 387,\n            columnNumber: 27\n          }\n        }, _this3.state.cargosAtuais[membro.id] ? _this3.state.cargosAtuais[membro.id] : \"-\"), /*#__PURE__*/React.createElement(\"td\", {\n          __self: _this3,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 392,\n            columnNumber: 27\n          }\n        }, /*#__PURE__*/React.createElement(FormSelect, {\n          name: \"cargos\",\n          id: idx,\n          onChange: _this3.change,\n          __self: _this3,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 393,\n            columnNumber: 29\n          }\n        }, _this3.state.listaCargos.map(function (cargo, index) {\n          return /*#__PURE__*/React.createElement(\"option\", {\n            value: cargo,\n            __self: _this3,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 399,\n              columnNumber: 33\n            }\n          }, cargo);\n        }))));\n      }))))))), /*#__PURE__*/React.createElement(Modal.Footer, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 412,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        theme: \"danger\",\n        onClick: this.closeModal,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 413,\n          columnNumber: 13\n        }\n      }, closeButton[languageCode]), /*#__PURE__*/React.createElement(Button, {\n        theme: \"success\",\n        onClick: this.createTransaction,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 416,\n          columnNumber: 13\n        }\n      }, saveButton[languageCode]))));\n    }\n  }]);\n\n  return CargosModal;\n}(React.Component);\n\nexport default CargosModal;","map":{"version":3,"sources":["C:/Users/User/Desktop/Ambiente de Trabalho/Universidade/Ano 3/Semestre 2/PI/Projeto/repos/pi-assoc-pais/develop/src/components/cargos-page/CargosModal.js"],"names":["React","Fragment","useState","ReactDOM","Modal","Redirect","ListGroup","ListGroupItem","Button","Col","Form","FormGroup","FormInput","FormFeedback","FormTextarea","FormCheckbox","FormSelect","languageCode","parentsParameters","showToast","toastTypes","saveButton","closeButton","newCargoTransactionButton","newCargosTitle","newCargosHeaderName","newCargosHeaderEmail","newCargosHeaderCargoAtual","newCargosHeaderNovoCargo","cargosSemCargo","cargosSemMudanca","moment","Multiselect","addCasoError","sucessoGeral","cargosGetError","cargosNothingToUpdateWarning","cargosUpdateError","erroCargosRepetidos","loadingInfo","erroCargosAdminEmFalta","firestore","firebase_auth","firebase","firebaseConfig","toast","Bounce","saveCaseToDB","loading","CargosModal","props","state","show","admin","redirect","listaCargos","cargosAtuais","changes","membersComplete","membrosSelected","options","componentDidMount","bind","createTransaction","change","showModal","closeModal","loadParents","currentUser","JSON","parse","window","localStorage","getItem","admin_","Admin","setState","pathname","parentsCollection","collection","get","then","querySnapshot","membersArray","membersArrayComplete","index","forEach","doc","data","undefined","toString","push","nome","id","photo","name","length","project_id","projectId","this_","uri","INFO","request","fetch","resp","json","cargosList","currentCargosList","cargos","users","i","x","Cargo","catch","error","ERROR","event","target","value","tamanho","Object","keys","WARNING","mudanca","listaMembros","data_","Date","format","cargo","console","log","cargosCollection","usersAndNewCargos","membroJson","cargosAnalyzed","cargosRepetidos","numCorretoCargosAdmin","k","includes","numberAdminRoles","encodeURIComponent","stringify","SUCCESS","getTransitions","display","overflow","whitespace","map","membro","idx","Component"],"mappings":"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","sourcesContent":["/* eslint jsx-a11y/anchor-is-valid: 0 */\r\n\r\nimport React, { Fragment, useState } from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport Modal from \"react-bootstrap/Modal\";\r\nimport { Redirect } from \"react-router\";\r\nimport {\r\n  ListGroup,\r\n  ListGroupItem,\r\n  Button,\r\n  Col,\r\n  Form,\r\n  FormGroup,\r\n  FormInput,\r\n  FormFeedback,\r\n  FormTextarea,\r\n  FormCheckbox, FormSelect,\r\n} from \"shards-react\";\r\nimport {\r\n  languageCode,\r\n  parentsParameters,\r\n  showToast,\r\n  toastTypes,\r\n  saveButton,\r\n  closeButton,\r\n  newCargoTransactionButton,\r\n  newCargosTitle,\r\n  newCargosHeaderName,\r\n  newCargosHeaderEmail,\r\n  newCargosHeaderCargoAtual,\r\n  newCargosHeaderNovoCargo,\r\n  cargosSemCargo,\r\n  cargosSemMudanca,\r\n} from \"../../utils/general_utils\";\r\nimport * as moment from \"moment\";\r\nimport { Multiselect } from \"multiselect-react-dropdown\";\r\nimport {\r\n  addCasoError,\r\n  sucessoGeral,\r\n  cargosGetError,\r\n  cargosNothingToUpdateWarning,\r\n  cargosUpdateError, erroCargosRepetidos, loadingInfo, erroCargosAdminEmFalta,\r\n} from \"../../utils/messages_strings\";\r\nimport {\r\n  firestore,\r\n  firebase_auth,\r\n  firebase,\r\n  firebaseConfig,\r\n} from \"../../firebase-config\";\r\nimport { toast, Bounce } from \"react-toastify\";\r\nimport { saveCaseToDB } from \"../../firebase_scripts/installation\";\r\nimport {loading} from \"../../utils/common_strings\";\r\n\r\nclass CargosModal extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      show: false,\r\n      admin: false,\r\n      redirect: null,\r\n      listaCargos: [],\r\n      cargosAtuais: {},\r\n      changes: {},\r\n\r\n      membersComplete: [],\r\n      membrosSelected: [],\r\n      options: [],\r\n    };\r\n\r\n    this.componentDidMount = this.componentDidMount.bind(this);\r\n    this.createTransaction = this.createTransaction.bind(this);\r\n    this.change = this.change.bind(this);\r\n    this.showModal = this.showModal.bind(this);\r\n    this.closeModal = this.closeModal.bind(this);\r\n    this.loadParents = this.loadParents.bind(this);\r\n\r\n    this.loadParents();\r\n  }\r\n\r\n  componentDidMount() {\r\n    let currentUser = JSON.parse(window.localStorage.getItem(\"userDoc\"));\r\n    if (currentUser != null) {\r\n      let admin_ = currentUser.Admin;\r\n      this.setState({ admin: admin_ });\r\n    } else {\r\n      //Redirect to login\r\n      var redirect = (\r\n        <Redirect\r\n          to={{\r\n            pathname: \"/\",\r\n          }}\r\n        />\r\n      );\r\n      this.setState({ redirect: redirect });\r\n    }\r\n  }\r\n\r\n  loadParents() {\r\n    const parentsCollection = firestore.collection(\"parents\");\r\n\r\n    parentsCollection.get().then((querySnapshot) => {\r\n      var membersArray = [];\r\n      var membersArrayComplete = [];\r\n      var options = [];\r\n\r\n      var index = 0;\r\n      querySnapshot.forEach((doc) => {\r\n        if (doc.data()[\"Nome\"] != undefined && doc.data()[\"Nome\"] != null) {\r\n          if (\r\n            doc.data()[\"Validated\"] != undefined &&\r\n            doc.data()[\"Validated\"] != null &&\r\n            doc.data()[\"Validated\"].toString() != \"false\"\r\n          ) {\r\n            membersArrayComplete.push({\r\n              nome: doc.data()[\"Nome\"],\r\n              id: doc.data()[\"Email\"],\r\n              photo: doc.data()[\"photo\"],\r\n            });\r\n            options.push({ id: index, name: doc.data()[\"Nome\"] });\r\n            index += 1;\r\n          }\r\n        }\r\n      });\r\n      if (options.length != 0) {\r\n        //console.log(membersArrayComplete);\r\n        this.setState({\r\n          membersComplete: membersArrayComplete,\r\n          options: options,\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  showModal() {\r\n    const project_id = firebaseConfig.projectId;\r\n    const this_ = this;\r\n\r\n    let uri =\r\n      \"https://us-central1-\" +\r\n      project_id +\r\n      \".cloudfunctions.net/api/getUserCargos\";\r\n\r\n    showToast(\r\n      loading[languageCode],\r\n      2000,\r\n      toastTypes.INFO\r\n    );\r\n\r\n    const request = async () => {\r\n      await fetch(uri)\r\n        .then((resp) => resp.json()) // Transform the data into json\r\n        .then(function (data) {\r\n          let cargosList = [];\r\n          let currentCargosList = {};\r\n          let cargos = data.cargos;\r\n          let users = data.users;\r\n\r\n          cargosList.push(cargosSemMudanca[languageCode]);\r\n          for (let i = 0; i < cargos.length; i++) {\r\n            cargosList.push(cargos[i]);\r\n          }\r\n          for (let x = 0; x < users.length; x++) {\r\n            let json = users[x];\r\n            currentCargosList[json.id] = json.Cargo;\r\n          }\r\n\r\n          this_.setState({\r\n            listaCargos: cargosList,\r\n            cargosAtuais: currentCargosList,\r\n            show: true,\r\n          });\r\n        })\r\n        .catch(function (error) {\r\n          showToast(cargosGetError[languageCode], 5000, toastTypes.ERROR);\r\n        });\r\n    };\r\n\r\n    request();\r\n  }\r\n\r\n  closeModal() {\r\n    this.setState({\r\n      show: false,\r\n      membrosSelected: [],\r\n    });\r\n  }\r\n\r\n  change(event) {\r\n    var index = event.target.id;\r\n    var changes = this.state.changes;\r\n\r\n    changes[index] = event.target.value;\r\n    this.setState({ changes: changes });\r\n  }\r\n\r\n  createTransaction() {\r\n    const { changes, membersComplete, cargosAtuais } = this.state;\r\n    const this_ = this;\r\n    const project_id = firebaseConfig.projectId;\r\n\r\n    var tamanho = Object.keys(changes).length;\r\n    var keys = Object.keys(changes);\r\n\r\n    if (tamanho === 0) {\r\n      showToast(\r\n        cargosNothingToUpdateWarning[languageCode],\r\n        5000,\r\n        toastTypes.WARNING\r\n      );\r\n    } else {\r\n      var mudanca = false;\r\n      var listaMembros = [];\r\n      var data_ = new Date();\r\n      var data = moment(data_).format(\"DD-MM-YYYY\").toString();\r\n\r\n      for (var i = 0; i < tamanho; i++) {\r\n        if (\r\n          changes[keys[i]] !== cargosSemMudanca[languageCode] &&\r\n          changes[keys[i]] !== cargosAtuais[membersComplete[keys[i]].id]\r\n        ) {\r\n          mudanca = true;\r\n          listaMembros.push({\r\n            nome: membersComplete[keys[i]].nome,\r\n            id: membersComplete[keys[i]].id,\r\n            cargo: changes[keys[i]],\r\n            data: data,\r\n          });\r\n        }\r\n      }\r\n\r\n      if (mudanca) {\r\n\r\n        /*\r\n        * FLUXO:\r\n        *   - buscar o userAndCurrentCargos\r\n        *   - modificar (cópia) as linhas correspondentes à lista de membros\r\n        *   - percorrer a cópia e ver se há cargos admin repetidos\r\n        *       - se sim, mensagem a informar e impedir a operação\r\n        * */\r\n\r\n        console.log(\"cargosCollection v\");\r\n        console.log(this.props.cargosCollection);\r\n\r\n        let usersAndNewCargos = {...this_.state.cargosAtuais};\r\n\r\n        // update local copy to reflect new roles\r\n        for(let i in listaMembros){\r\n          let membroJson = listaMembros[i];\r\n          const id = membroJson.id;\r\n          usersAndNewCargos[id] = membroJson.cargo;\r\n        }\r\n\r\n        console.log(\"usersAndNewCargos v\");\r\n        console.log(usersAndNewCargos);\r\n\r\n        let cargosAnalyzed = [];\r\n        let cargosRepetidos = false;\r\n        let numCorretoCargosAdmin = true;\r\n\r\n        for(let k in usersAndNewCargos){\r\n          const cargo = usersAndNewCargos[k];\r\n          // if it's admin role\r\n          if(this.props.cargosCollection[cargo]){\r\n            if(cargosAnalyzed.includes(cargo)){\r\n              cargosRepetidos = true;\r\n              break;\r\n            }\r\n            cargosAnalyzed.push(cargo);\r\n          }\r\n        }\r\n\r\n        //cargosAnalyzed should contain every admin role once and only once\r\n        if(cargosAnalyzed.length!==this_.props.numberAdminRoles){\r\n          numCorretoCargosAdmin = false;\r\n        }\r\n\r\n\r\n        console.log(\"cargosAnalyzed -> \" + cargosAnalyzed.toString());\r\n\r\n        if(cargosRepetidos){\r\n          showToast(\r\n            erroCargosRepetidos[languageCode],\r\n            5000,\r\n            toastTypes.WARNING\r\n          );\r\n        }else if(!numCorretoCargosAdmin){\r\n          showToast(\r\n            erroCargosAdminEmFalta[languageCode],\r\n            5000,\r\n            toastTypes.WARNING\r\n          );\r\n        }else{\r\n          let uri =\r\n            \"https://us-central1-\" +\r\n            project_id +\r\n            \".cloudfunctions.net/api/sendCargoChangeEmail?\" +\r\n            \"membros=\" +\r\n            encodeURIComponent(JSON.stringify(listaMembros));\r\n\r\n          const request = async () => {\r\n            await fetch(uri)\r\n              .then(function (data) {\r\n                showToast(sucessoGeral[languageCode], 5000, toastTypes.SUCCESS);\r\n\r\n                this_.props.getTransitions();\r\n                this_.closeModal();\r\n              })\r\n              .catch(function (error) {\r\n                showToast(\r\n                  cargosUpdateError[languageCode],\r\n                  5000,\r\n                  toastTypes.ERROR\r\n                );\r\n              });\r\n          };\r\n          request();\r\n        }\r\n\r\n\r\n      } else {\r\n        showToast(\r\n          cargosNothingToUpdateWarning[languageCode],\r\n          5000,\r\n          toastTypes.WARNING\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <>\r\n        {this.state.admin ? (\r\n          <Button\r\n            size=\"md\"\r\n            theme=\"success\"\r\n            id=\"new_case\"\r\n            onClick={this.showModal}\r\n          >\r\n            <i className=\"fa fa-plus mr-1\" />{\" \"}\r\n            {newCargoTransactionButton[languageCode]}\r\n          </Button>\r\n        ) : (\r\n          \"\"\r\n        )}\r\n        {this.state.redirect}\r\n\r\n        <Modal size=\"lg\" show={this.state.show} onHide={this.closeModal}>\r\n          <Modal.Header closeButton>\r\n            <Modal.Title>{newCargosTitle[languageCode]}</Modal.Title>\r\n          </Modal.Header>\r\n          <Modal.Body>\r\n            <ListGroup flush>\r\n              <ListGroupItem className=\"p-3\">\r\n                <Col>\r\n                  <table\r\n                    className=\"table table-striped\"\r\n                    style={{\r\n                      display: \"block\",\r\n                      overflow: \"auto\",\r\n                      whitespace: \"nowrap\",\r\n                    }}\r\n                  >\r\n                    <thead className=\"bg-light\">\r\n                      <tr>\r\n                        <th scope=\"col\" className=\"border-0\">\r\n                          {newCargosHeaderName[languageCode]}\r\n                        </th>\r\n                        <th scope=\"col\" className=\"border-0\">\r\n                          {newCargosHeaderEmail[languageCode]}\r\n                        </th>\r\n                        <th scope=\"col\" className=\"border-0\">\r\n                          {newCargosHeaderCargoAtual[languageCode]}\r\n                        </th>\r\n                        <th scope=\"col\" className=\"border-0\">\r\n                          {newCargosHeaderNovoCargo[languageCode]}\r\n                        </th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                      {this.state.membersComplete.map((membro, idx) => (\r\n                        <tr>\r\n                          <td>{membro.nome}</td>\r\n\r\n                          <td>{membro.id}</td>\r\n                          <td>\r\n                            {this.state.cargosAtuais[membro.id]\r\n                              ? this.state.cargosAtuais[membro.id]\r\n                              : \"-\"}\r\n                          </td>\r\n                          <td>\r\n                            <FormSelect\r\n                              name=\"cargos\"\r\n                              id={idx}\r\n                              onChange={this.change}\r\n                            >\r\n                              {this.state.listaCargos.map((cargo, index) => (\r\n                                <option value={cargo}>{cargo}</option>\r\n                              ))}\r\n                            </FormSelect >\r\n                          </td>\r\n                        </tr>\r\n                      ))}\r\n                    </tbody>\r\n                  </table>\r\n                </Col>\r\n              </ListGroupItem>\r\n            </ListGroup>\r\n          </Modal.Body>\r\n\r\n          <Modal.Footer>\r\n            <Button theme=\"danger\" onClick={this.closeModal}>\r\n              {closeButton[languageCode]}\r\n            </Button>\r\n            <Button theme=\"success\" onClick={this.createTransaction}>\r\n              {saveButton[languageCode]}\r\n            </Button>\r\n          </Modal.Footer>\r\n        </Modal>\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport default CargosModal;\r\n"]},"metadata":{},"sourceType":"module"}