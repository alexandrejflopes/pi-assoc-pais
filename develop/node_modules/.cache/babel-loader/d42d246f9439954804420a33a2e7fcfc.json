{"ast":null,"code":"import _defineProperty from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";\nvar _jsxFileName = \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\src\\\\views\\\\Profile.js\";\nimport React from \"react\";\nimport { Container, Row, Col } from \"shards-react\";\nimport PageTitle from \"../components/common/PageTitle\";\nimport UserOverview from \"../components/profile/UserOverview\";\nimport UserInfo from \"../components/profile/UserInfo\";\nimport { Redirect } from \"react-router-dom\";\nimport { fetchUserDoc, getNewParams, mapParamsToInputType, updateParent } from \"../firebase_scripts/profile_functions\";\nimport { firebase_auth } from \"../firebase-config\";\nimport { defaultAvatar, languageCode, parentsParameters, showToast, toastTypes } from \"../utils/general_utils\";\nimport { profilePageTitle } from \"../utils/page_titles_strings\";\nimport { loadingInfo, parentUpdatePhotoError, parentUpdatePhotoSuccess } from \"../utils/messages_strings\";\nimport UserActions from \"../components/layout/MainNavbar/NavbarNav/UserActions\";\nimport { getAssocDoc } from \"../firebase_scripts/get_assoc_info\";\n\nvar Profile = /*#__PURE__*/function (_React$Component) {\n  _inherits(Profile, _React$Component);\n\n  var _super = _createSuper(Profile);\n\n  function Profile(props) {\n    var _this;\n\n    _classCallCheck(this, Profile);\n\n    _this = _super.call(this, props);\n    var userEmail,\n        userProvided,\n        assoc = null;\n\n    if (_this.props.location.state != null) {\n      userEmail = _this.props.location.state.userEmail;\n      userProvided = _this.props.location.state.userProvided;\n    } else {\n      if (window.localStorage.getItem(\"email\") != null) {\n        userEmail = window.localStorage.getItem(\"email\");\n        userProvided = true;\n      }\n    }\n\n    _this.state = {\n      userEmail: userEmail,\n      userProvided: userProvided != null ? userProvided : false,\n      userDoc: null,\n      editingProfile: false,\n      newParamsInputTypes: null,\n      assocDoc: assoc\n    };\n    _this.saveNewParams = _this.saveNewParams.bind(_assertThisInitialized(_this));\n    _this.componentDidMount = _this.componentDidMount.bind(_assertThisInitialized(_this));\n    _this.setupAssocDoc = _this.setupAssocDoc.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n  /*********************************** LIFECYCLE ***********************************/\n\n\n  _createClass(Profile, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount(updating) {\n      var this_ = this; //this._isMounted = true;\n\n      if (updating) {\n        var localUser = JSON.parse(window.localStorage.getItem(\"userDoc\"));\n\n        if (localUser != null) {\n          this_.setState({\n            userDoc: localUser\n          });\n        }\n\n        var localAssocDoc = JSON.parse(window.localStorage.getItem(\"assocDoc\"));\n\n        if (localAssocDoc != null) {\n          this_.setState({\n            assocDoc: localAssocDoc\n          });\n        }\n      } else {\n        //console.log(\"DID MOUNT!\");\n        var currentUser = firebase_auth.currentUser;\n\n        var _localUser = JSON.parse(window.localStorage.getItem(\"userDoc\")); //console.log(\"localuser -> \" + JSON.stringify(localUser));\n\n\n        if (currentUser != null) {\n          if (_localUser != null) {\n            if (_localUser[parentsParameters.EMAIL[languageCode]] !== firebase_auth.currentUser.email) {\n              var userPromise = fetchUserDoc(this_.state.userEmail);\n              userPromise.then(function (result) {\n                //console.log(\"1. Result userDoc: \" + JSON.stringify(result));\n                if (result.error == null) {\n                  // no error\n                  //console.log(\"atualizar state com user doc recebido\");\n                  this_.setState({\n                    userDoc: result\n                  });\n                  window.localStorage.setItem(\"userDoc\", JSON.stringify(result));\n                  UserActions.componentDidMount();\n                  this_.saveNewParams();\n                }\n              }).catch(function (error) {\n                console.log(\"error userDoc: \" + JSON.stringify(error));\n                this_.componentDidMount();\n              });\n            } else {\n              //console.log(\"atualizar state com localUser\");\n              this_.saveNewParams();\n              this_.setState({\n                userDoc: _localUser\n              });\n            }\n          } else {\n            //console.log(\"não há user no LS, buscar novo\");\n            var _userPromise = fetchUserDoc(this_.state.userEmail);\n\n            _userPromise.then(function (result) {\n              //console.log(\"2. Result userDoc: \" + JSON.stringify(result));\n              if (result.error == null) {\n                // TODO: check\n                var parent = result;\n                var currentUserPhoto = currentUser.photoURL;\n                var resultUserPhoto = parent[parentsParameters.PHOTO[languageCode]]; //console.log(\"currentUserPhotoUrl -> \" + currentUserPhoto);\n                //console.log(\"resultUserPhoto -> \" + resultUserPhoto);\n\n                if (currentUserPhoto != null) {\n                  if (currentUserPhoto !== resultUserPhoto) {\n                    parent[parentsParameters.PHOTO[languageCode]] = currentUserPhoto;\n\n                    var photoField = _defineProperty({}, parentsParameters.PHOTO[languageCode], currentUserPhoto);\n\n                    updateParent(currentUser.email, photoField).then(function () {//console.log(\"updated parent with provider photo in DB\")\n                    }).catch(function (error) {\n                      if (Object.keys(error).length !== 0) {//console.log(\"update error: \" + JSON.stringify(error));\n                      }\n                    });\n                  }\n                } // ----------------------------------------------------------------------\n                // no error\n                //console.log(\"atualizar state com user doc recebido\");\n                //console.log(\"parent com foto do provider -> \" + JSON.stringify(parent));\n\n\n                this_.setState({\n                  userDoc: parent\n                });\n                window.localStorage.setItem(\"userDoc\", JSON.stringify(parent));\n                this_.saveNewParams();\n                UserActions.componentDidMount();\n              }\n            }).catch(function (error) {\n              //console.log(\"2. error userDoc: \" + JSON.stringify(error));\n              this_.componentDidMount();\n            });\n          }\n        }\n\n        this_.setupAssocDoc();\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this._isMounted = false;\n    }\n    /*********************************** HANDLERS ***********************************/\n\n  }, {\n    key: \"setupAssocDoc\",\n    value: function setupAssocDoc() {\n      var _this2 = this;\n\n      var localAssocDoc = JSON.parse(window.localStorage.getItem(\"assocDoc\"));\n\n      if (localAssocDoc != null) {\n        this.setState({\n          assocDoc: localAssocDoc\n        });\n      } else {\n        var promise = getAssocDoc();\n        promise.then(function (doc) {\n          if (!doc.exists) {//console.log('No assotiation document found!');\n          } else {\n            var data = doc.data();\n            window.localStorage.setItem(\"assocDoc\", JSON.stringify(data));\n\n            _this2.setState({\n              assocDoc: localAssocDoc\n            });\n          }\n        }).catch(function (err) {\n          console.log('Error getting document', err);\n        });\n      }\n    }\n  }, {\n    key: \"saveNewParams\",\n    value: function saveNewParams() {\n      var _this3 = this;\n\n      //console.log(\"entrei nos newParamsTypes\");\n      var newParamsInputTypes = JSON.parse(window.localStorage.getItem(\"newParamsInputTypes\")); //console.log(\"newParamsTypes no LS: \" + JSON.stringify(newParamsInputTypes));\n\n      if (newParamsInputTypes != null) {\n        //console.log(\"recebi newParamsTypes: \" + JSON.stringify(newParamsInputTypes));\n        this.setState({\n          newParamsInputTypes: newParamsInputTypes\n        });\n      } else {\n        var paramsPromise = getNewParams(this.state.userEmail);\n        paramsPromise.then(function (result) {\n          //console.log(\"Result paramsDoc: \" + JSON.stringify(result));\n          if (result.error == null) {\n            // no error\n            var _newParamsInputTypes = mapParamsToInputType(result);\n\n            _this3.setState({\n              newParamsInputTypes: _newParamsInputTypes\n            }); //console.log(\"newParamsTypes do LocalStorage: \" + JSON.stringify(newParamsInputTypes));\n\n\n            window.localStorage.setItem(\"newParamsInputTypes\", JSON.stringify(_newParamsInputTypes));\n          }\n        }).catch(function (error) {//console.log(\"error paramsDoc: \" + JSON.stringify(error));\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      if (this.state.userEmail == null || !this.state.userProvided || firebase_auth.currentUser == null) {\n        return /*#__PURE__*/React.createElement(Redirect, {\n          to: \"/login\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 234,\n            columnNumber: 14\n          }\n        });\n      } else if (this.state.userDoc == null || Object.keys(this.state.userDoc).length === 0 || this.state.newParamsInputTypes == null) {\n        return /*#__PURE__*/React.createElement(Container, {\n          fluid: true,\n          className: \"main-content-container px-4\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 238,\n            columnNumber: 9\n          }\n        }, /*#__PURE__*/React.createElement(Row, {\n          noGutters: true,\n          className: \"page-header py-4\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 239,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(PageTitle, {\n          title: profilePageTitle[languageCode],\n          md: \"12\",\n          className: \"ml-sm-auto mr-sm-auto\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 240,\n            columnNumber: 13\n          }\n        })), /*#__PURE__*/React.createElement(Row, {\n          fluid: true,\n          style: {\n            display: \"flex\",\n            justifyContent: \"center\",\n            alignContent: \"center\",\n            alignItems: \"center\",\n            position: \"absolute\",\n            left: \"50%\",\n            top: \"50%\",\n            transform: \"translate(-50%, -50%)\"\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 246,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(\"h2\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 259,\n            columnNumber: 13\n          }\n        }, loadingInfo[languageCode])));\n      } else {\n        return /*#__PURE__*/React.createElement(Container, {\n          fluid: true,\n          className: \"main-content-container px-4\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 265,\n            columnNumber: 9\n          }\n        }, /*#__PURE__*/React.createElement(Row, {\n          noGutters: true,\n          className: \"page-header py-4\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 266,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(PageTitle, {\n          title: profilePageTitle[languageCode],\n          md: \"12\",\n          className: \"ml-sm-auto mr-sm-auto\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 267,\n            columnNumber: 13\n          }\n        })), /*#__PURE__*/React.createElement(Row, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 273,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(Col, {\n          lg: \"4\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 274,\n            columnNumber: 13\n          }\n        }, /*#__PURE__*/React.createElement(UserOverview, {\n          user: this.state.userDoc,\n          newParamsTypes: this.state.newParamsInputTypes,\n          componentDidMount: this.componentDidMount,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 275,\n            columnNumber: 15\n          }\n        })), /*#__PURE__*/React.createElement(Col, {\n          lg: \"8\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 281,\n            columnNumber: 13\n          }\n        }, /*#__PURE__*/React.createElement(UserInfo, {\n          userD: this.state.userDoc,\n          newParamsTypesD: this.state.newParamsInputTypes,\n          componentDidMount: this.componentDidMount,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 282,\n            columnNumber: 15\n          }\n        }))));\n      }\n    }\n  }]);\n\n  return Profile;\n}(React.Component);\n\nexport default Profile;","map":{"version":3,"sources":["C:/Users/User/Desktop/Ambiente de Trabalho/Universidade/Ano 3/Semestre 2/PI/Projeto/repos/pi-assoc-pais/develop/src/views/Profile.js"],"names":["React","Container","Row","Col","PageTitle","UserOverview","UserInfo","Redirect","fetchUserDoc","getNewParams","mapParamsToInputType","updateParent","firebase_auth","defaultAvatar","languageCode","parentsParameters","showToast","toastTypes","profilePageTitle","loadingInfo","parentUpdatePhotoError","parentUpdatePhotoSuccess","UserActions","getAssocDoc","Profile","props","userEmail","userProvided","assoc","location","state","window","localStorage","getItem","userDoc","editingProfile","newParamsInputTypes","assocDoc","saveNewParams","bind","componentDidMount","setupAssocDoc","updating","this_","localUser","JSON","parse","setState","localAssocDoc","currentUser","EMAIL","email","userPromise","then","result","error","setItem","stringify","catch","console","log","parent","currentUserPhoto","photoURL","resultUserPhoto","PHOTO","photoField","Object","keys","length","_isMounted","promise","doc","exists","data","err","paramsPromise","display","justifyContent","alignContent","alignItems","position","left","top","transform","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { Container, Row, Col } from \"shards-react\";\n\nimport PageTitle from \"../components/common/PageTitle\";\nimport UserOverview from \"../components/profile/UserOverview\";\nimport UserInfo from \"../components/profile/UserInfo\";\nimport { Redirect } from \"react-router-dom\";\nimport {\n  fetchUserDoc,\n  getNewParams,\n  mapParamsToInputType, updateParent,\n} from \"../firebase_scripts/profile_functions\";\nimport { firebase_auth } from \"../firebase-config\";\nimport {\n  defaultAvatar,\n  languageCode,\n  parentsParameters, showToast, toastTypes\n} from \"../utils/general_utils\";\nimport { profilePageTitle } from \"../utils/page_titles_strings\";\nimport {\n  loadingInfo,\n  parentUpdatePhotoError,\n  parentUpdatePhotoSuccess\n} from \"../utils/messages_strings\";\nimport UserActions from \"../components/layout/MainNavbar/NavbarNav/UserActions\";\nimport {getAssocDoc} from \"../firebase_scripts/get_assoc_info\";\n\nclass Profile extends React.Component {\n  constructor(props) {\n    super(props);\n\n    let userEmail, userProvided, assoc = null;\n    if (this.props.location.state != null) {\n      userEmail = this.props.location.state.userEmail;\n      userProvided = this.props.location.state.userProvided;\n    } else {\n      if (window.localStorage.getItem(\"email\") != null) {\n        userEmail = window.localStorage.getItem(\"email\");\n        userProvided = true;\n      }\n    }\n\n    this.state = {\n      userEmail: userEmail,\n      userProvided: userProvided != null ? userProvided : false,\n      userDoc: null,\n      editingProfile: false,\n      newParamsInputTypes: null,\n      assocDoc : assoc,\n    };\n\n\n    this.saveNewParams = this.saveNewParams.bind(this);\n    this.componentDidMount = this.componentDidMount.bind(this);\n    this.setupAssocDoc = this.setupAssocDoc.bind(this);\n  }\n\n  /*********************************** LIFECYCLE ***********************************/\n\n  componentDidMount(updating) {\n\n    const this_ = this;\n    //this._isMounted = true;\n\n    if(updating){\n      const localUser = JSON.parse(window.localStorage.getItem(\"userDoc\"));\n\n      if(localUser!=null){\n        this_.setState({userDoc : localUser});\n      }\n\n      const localAssocDoc = JSON.parse(window.localStorage.getItem(\"assocDoc\"));\n      if(localAssocDoc!=null){\n        this_.setState({assocDoc: localAssocDoc});\n      }\n    }\n\n\n    else{\n      //console.log(\"DID MOUNT!\");\n      const currentUser = firebase_auth.currentUser;\n      const localUser = JSON.parse(window.localStorage.getItem(\"userDoc\"));\n      //console.log(\"localuser -> \" + JSON.stringify(localUser));\n\n      if(currentUser!=null){\n        if(localUser!=null){\n          if (localUser[parentsParameters.EMAIL[languageCode]] !== firebase_auth.currentUser.email) {\n            const userPromise = fetchUserDoc(this_.state.userEmail);\n\n            userPromise\n              .then((result) => {\n                //console.log(\"1. Result userDoc: \" + JSON.stringify(result));\n                if (result.error == null) {\n                  // no error\n                  //console.log(\"atualizar state com user doc recebido\");\n                  this_.setState({ userDoc: result });\n                  window.localStorage.setItem(\"userDoc\", JSON.stringify(result));\n                  UserActions.componentDidMount();\n                  this_.saveNewParams();\n                }\n              })\n              .catch((error) => {\n                console.log(\"error userDoc: \" + JSON.stringify(error));\n                this_.componentDidMount();\n              });\n          }\n          else {\n            //console.log(\"atualizar state com localUser\");\n            this_.saveNewParams();\n            this_.setState({ userDoc: localUser });\n          }\n        }\n        else {\n          //console.log(\"não há user no LS, buscar novo\");\n          const userPromise = fetchUserDoc(this_.state.userEmail);\n\n          userPromise\n            .then((result) => {\n              //console.log(\"2. Result userDoc: \" + JSON.stringify(result));\n              if (result.error == null) {\n\n                // TODO: check\n                let parent = result;\n                const currentUserPhoto = currentUser.photoURL;\n                const resultUserPhoto = parent[parentsParameters.PHOTO[languageCode]];\n                //console.log(\"currentUserPhotoUrl -> \" + currentUserPhoto);\n                //console.log(\"resultUserPhoto -> \" + resultUserPhoto);\n\n                if(currentUserPhoto!=null){\n                  if(currentUserPhoto!==resultUserPhoto){\n                    parent[parentsParameters.PHOTO[languageCode]] = currentUserPhoto;\n                    const photoField = {[parentsParameters.PHOTO[languageCode]] : currentUserPhoto};\n                    updateParent(currentUser.email, photoField)\n                      .then(() => {\n                        //console.log(\"updated parent with provider photo in DB\")\n                      })\n                      .catch((error) => {\n                        if(Object.keys(error).length!==0){\n                          //console.log(\"update error: \" + JSON.stringify(error));\n                        }\n                      });\n                  }\n                }\n                // ----------------------------------------------------------------------\n\n                // no error\n                //console.log(\"atualizar state com user doc recebido\");\n                //console.log(\"parent com foto do provider -> \" + JSON.stringify(parent));\n                this_.setState({ userDoc: parent });\n\n                window.localStorage.setItem(\"userDoc\", JSON.stringify(parent));\n                this_.saveNewParams();\n                UserActions.componentDidMount();\n              }\n            })\n            .catch((error) => {\n              //console.log(\"2. error userDoc: \" + JSON.stringify(error));\n              this_.componentDidMount();\n            });\n        }\n      }\n\n      this_.setupAssocDoc();\n    }\n\n\n\n}\n\n\n  componentWillUnmount() {\n    this._isMounted = false;\n  }\n\n  /*********************************** HANDLERS ***********************************/\n\n  setupAssocDoc(){\n    const localAssocDoc = JSON.parse(window.localStorage.getItem(\"assocDoc\"));\n    if(localAssocDoc!=null){\n      this.setState({assocDoc: localAssocDoc});\n    }\n    else{\n      const promise = getAssocDoc();\n      promise\n        .then(doc => {\n          if (!doc.exists) {\n            //console.log('No assotiation document found!');\n          }\n          else {\n            const data = doc.data();\n            window.localStorage.setItem(\"assocDoc\", JSON.stringify(data));\n            this.setState({\n              assocDoc: localAssocDoc\n            });\n          }\n        })\n        .catch(err => {\n          console.log('Error getting document', err);\n        });\n    }\n  }\n\n  saveNewParams() {\n    //console.log(\"entrei nos newParamsTypes\");\n    const newParamsInputTypes = JSON.parse(window.localStorage.getItem(\"newParamsInputTypes\"));\n    //console.log(\"newParamsTypes no LS: \" + JSON.stringify(newParamsInputTypes));\n    if (newParamsInputTypes != null) {\n      //console.log(\"recebi newParamsTypes: \" + JSON.stringify(newParamsInputTypes));\n      this.setState({ newParamsInputTypes: newParamsInputTypes });\n    }\n    else {\n      const paramsPromise = getNewParams(this.state.userEmail);\n\n      paramsPromise\n        .then((result) => {\n          //console.log(\"Result paramsDoc: \" + JSON.stringify(result));\n          if (result.error == null) {\n            // no error\n            const newParamsInputTypes = mapParamsToInputType(result);\n            this.setState({ newParamsInputTypes: newParamsInputTypes });\n\n            //console.log(\"newParamsTypes do LocalStorage: \" + JSON.stringify(newParamsInputTypes));\n            window.localStorage.setItem(\"newParamsInputTypes\", JSON.stringify(newParamsInputTypes));\n          }\n        })\n        .catch((error) => {\n          //console.log(\"error paramsDoc: \" + JSON.stringify(error));\n        });\n    }\n  }\n\n  render() {\n    if (this.state.userEmail == null || !this.state.userProvided || firebase_auth.currentUser == null) {\n      return <Redirect to=\"/login\" />;\n    }\n    else if (this.state.userDoc == null || Object.keys(this.state.userDoc).length === 0 || this.state.newParamsInputTypes == null) {\n      return (\n        <Container fluid className=\"main-content-container px-4\">\n          <Row noGutters className=\"page-header py-4\">\n            <PageTitle\n              title={profilePageTitle[languageCode]}\n              md=\"12\"\n              className=\"ml-sm-auto mr-sm-auto\"\n            />\n          </Row>\n          <Row\n            fluid\n            style={{\n              display: \"flex\",\n              justifyContent: \"center\",\n              alignContent: \"center\",\n              alignItems: \"center\",\n              position: \"absolute\",\n              left: \"50%\",\n              top: \"50%\",\n              transform: \"translate(-50%, -50%)\",\n            }}\n          >\n            <h2>{loadingInfo[languageCode]}</h2>\n          </Row>\n        </Container>\n      );\n    } else {\n      return (\n        <Container fluid className=\"main-content-container px-4\">\n          <Row noGutters className=\"page-header py-4\">\n            <PageTitle\n              title={profilePageTitle[languageCode]}\n              md=\"12\"\n              className=\"ml-sm-auto mr-sm-auto\"\n            />\n          </Row>\n          <Row>\n            <Col lg=\"4\">\n              <UserOverview\n                user={this.state.userDoc}\n                newParamsTypes={this.state.newParamsInputTypes}\n                componentDidMount={this.componentDidMount}\n              />\n            </Col>\n            <Col lg=\"8\">\n              <UserInfo\n                userD={this.state.userDoc}\n                newParamsTypesD={this.state.newParamsInputTypes}\n                componentDidMount={this.componentDidMount}\n              />\n            </Col>\n          </Row>\n        </Container>\n      );\n    }\n  }\n}\n\nexport default Profile;\n"]},"metadata":{},"sourceType":"module"}