{"ast":null,"code":"import _classCallCheck from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";\nvar _jsxFileName = \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\src\\\\components\\\\layout\\\\MainNavbar\\\\NavbarNav\\\\UserActions.js\";\nimport React from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { Dropdown, DropdownToggle, DropdownMenu, DropdownItem, Collapse, NavItem, NavLink, Row } from \"shards-react\";\nimport { defaultAvatar, languageCode, parentsParameters } from \"../../../../utils/general_utils\";\nimport { profileLogout, profilePageTitle, profileSettings, profileSettingsAdminSectionTitle } from \"../../../../utils/page_titles_strings\";\nimport { fetchUserDoc, userLogOut } from \"../../../../firebase_scripts/profile_functions\";\nimport { firebase_auth } from \"../../../../firebase-config\";\n\nvar UserActions = /*#__PURE__*/function (_React$Component) {\n  _inherits(UserActions, _React$Component);\n\n  var _super = _createSuper(UserActions);\n\n  function UserActions(props) {\n    var _this;\n\n    _classCallCheck(this, UserActions);\n\n    _this = _super.call(this, props);\n    _this.state = {\n      visible: false,\n      userName: \"ND\",\n      userPhoto: defaultAvatar,\n      isAdmin: false\n    };\n    _this.toggleUserActions = _this.toggleUserActions.bind(_assertThisInitialized(_this));\n    _this.updateNavBarUserPhotoAndName = _this.updateNavBarUserPhotoAndName.bind(_assertThisInitialized(_this)); //this.updateNavBarUserPhotoAndNameV2 = this.updateNavBarUserPhotoAndNameV2.bind(this);\n\n    _this.updateNavBar = _this.updateNavBar.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n  /*********************************** LIFECYCLE ***********************************/\n\n\n  _createClass(UserActions, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this._isMounted = true;\n      this.updateNavBarUserPhotoAndName(); //this.updateNavBarUserPhotoAndNameV2();\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this._isMounted = false;\n    }\n  }, {\n    key: \"toggleUserActions\",\n    value: function toggleUserActions() {\n      this.setState({\n        visible: !this.state.visible\n      });\n    }\n  }, {\n    key: \"updateNavBarUserPhotoAndNameV2\",\n    value: function updateNavBarUserPhotoAndNameV2() {\n      var currentUser = JSON.parse(window.localStorage.getItem(\"userDoc\")); //console.log(\"local User barra: \" + currentUser);\n\n      if (currentUser != null) {\n        var displayName = currentUser[parentsParameters.NAME[languageCode]];\n        var photoURL = currentUser[parentsParameters.PHOTO[languageCode]];\n        var isAdmin = currentUser[parentsParameters.ADMIN[languageCode]];\n        this.setState({\n          userName: displayName,\n          userPhoto: photoURL,\n          isAdmin: isAdmin\n        });\n      }\n    }\n  }, {\n    key: \"updateNavBar\",\n    value: function updateNavBar() {\n      console.log(\"UPDATE NAVBAR\"); // check the local storage to see if it's still the same user\n\n      var localUser = JSON.parse(window.localStorage.getItem(\"userDoc\")); // if no information about the user in the LS, then do nothing\n\n      if (localUser == null) {\n        console.log(\"localUser null\");\n        return;\n      }\n\n      var displayName = localUser[parentsParameters.NAME[languageCode]];\n      var photoURL = localUser[parentsParameters.PHOTO[languageCode]];\n      var isAdmin = localUser[parentsParameters.ADMIN[languageCode]];\n      console.log(\"photoURL barra -> \" + photoURL);\n      UserActions.setState({\n        userName: displayName,\n        userPhoto: photoURL,\n        isAdmin: isAdmin\n      });\n    }\n  }, {\n    key: \"updateNavBarUserPhotoAndName\",\n    value: function updateNavBarUserPhotoAndName() {\n      var _this2 = this;\n\n      console.log(\"ENTREI NO UPDATE COM CONTEXT\"); // check the local storage to see if it's still the same user\n\n      var localUser = JSON.parse(window.localStorage.getItem(\"userDoc\"));\n      var firebaseUser = firebase_auth.currentUser;\n      console.log(\"localUser barra: \" + JSON.stringify(localUser));\n      console.log(\"currentUser: barra\" + JSON.stringify(firebaseUser));\n\n      if (localUser != null && firebaseUser != null) {\n        var localEmail = localUser[parentsParameters.EMAIL[languageCode]]; // if the local storage user is old, update the nav bar with the new user (fetching it from firestore)\n\n        if (localEmail !== firebaseUser.email) {\n          //console.log(\"fetch na barra\");\n          fetchUserDoc(firebaseUser.email).then(function (result) {\n            //console.log(\"Result userDoc: \" + JSON.stringify(result));\n            if (result.error == null) {\n              // no error\n              var displayName = result[parentsParameters.NAME[languageCode]];\n              var photoURL = result[parentsParameters.PHOTO[languageCode]];\n              var isAdmin = result[parentsParameters.ADMIN[languageCode]];\n\n              _this2.setState({\n                userName: displayName,\n                userPhoto: photoURL,\n                isAdmin: isAdmin\n              });\n            }\n          }).catch(function (error) {\n            console.log(\"error no fetch da barra: \" + JSON.stringify(error));\n          });\n        } else {\n          //console.log(\"aproveitar o storage\");\n          var displayName = localUser[parentsParameters.NAME[languageCode]];\n          var photoURL = localUser[parentsParameters.PHOTO[languageCode]];\n          var isAdmin = localUser[parentsParameters.ADMIN[languageCode]];\n          this.setState({\n            userName: displayName,\n            userPhoto: photoURL,\n            isAdmin: isAdmin\n          });\n        }\n      } else if (localUser != null) {\n        //console.log(\"aproveitar o storage\");\n        var _displayName = localUser[parentsParameters.NAME[languageCode]];\n        var _photoURL = localUser[parentsParameters.PHOTO[languageCode]];\n        var _isAdmin = localUser[parentsParameters.ADMIN[languageCode]];\n        this.setState({\n          userName: _displayName,\n          userPhoto: _photoURL,\n          isAdmin: _isAdmin\n        });\n      } else if (firebaseUser != null) {\n        // if this code runs, then there's no user in local storage, so we have to fetch it from Firestore\n        fetchUserDoc(firebaseUser.email).then(function (result) {\n          //console.log(\"Result userDoc: \" + JSON.stringify(result));\n          if (result.error == null) {\n            // no error\n            var _displayName2 = result[parentsParameters.NAME[languageCode]];\n            var _photoURL2 = result[parentsParameters.PHOTO[languageCode]];\n            var _isAdmin2 = result[parentsParameters.ADMIN[languageCode]];\n\n            _this2.setState({\n              userName: _displayName2,\n              userPhoto: _photoURL2,\n              isAdmin: _isAdmin2\n            });\n          }\n        }).catch(function (error) {\n          console.log(\"error no fetch da barra: \" + JSON.stringify(error));\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return /*#__PURE__*/React.createElement(NavItem, {\n        tag: Dropdown,\n        caret: true,\n        toggle: this.toggleUserActions,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(DropdownToggle, {\n        caret: true,\n        tag: NavLink,\n        className: \"text-nowrap px-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"img\", {\n        className: \"user-avatar rounded-circle mr-2\",\n        src: this.state.userPhoto,\n        alt: \"User photo\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 162,\n          columnNumber: 11\n        }\n      }), \" \", /*#__PURE__*/React.createElement(\"span\", {\n        className: \"d-none d-md-inline-block\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 167,\n          columnNumber: 11\n        }\n      }, this.state.userName)), /*#__PURE__*/React.createElement(Collapse, {\n        tag: DropdownMenu,\n        right: true,\n        small: true,\n        open: this.state.visible,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(DropdownItem, {\n        tag: Link,\n        to: \"profile\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 172,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"i\", {\n        className: \"material-icons\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 13\n        }\n      }, \"\\uE7FD\"), \" \", profilePageTitle[languageCode]), /*#__PURE__*/React.createElement(DropdownItem, {\n        tag: Link,\n        to: \"profile-settings\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 176,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"i\", {\n        className: \"material-icons\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 13\n        }\n      }, \"\\uE8B8\"), \" \", profileSettings[languageCode], \" \"), this.state.isAdmin ? /*#__PURE__*/React.createElement(DropdownItem, {\n        tag: Link,\n        to: \"admin-settings\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"i\", {\n        className: \"material-icons\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 15\n        }\n      }, \"vpn_key\"), \" \", profileSettingsAdminSectionTitle[languageCode], \" \") : null, /*#__PURE__*/React.createElement(DropdownItem, {\n        divider: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 190,\n          columnNumber: 11\n        }\n      }), /*#__PURE__*/React.createElement(DropdownItem, {\n        tag: Link,\n        onClick: userLogOut,\n        className: \"text-danger\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"i\", {\n        className: \"material-icons text-danger\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 13\n        }\n      }, \"\\uE879\"), \" \", profileLogout[languageCode])));\n    }\n  }]);\n\n  return UserActions;\n}(React.Component);\n\nexport { UserActions as default };","map":{"version":3,"sources":["C:/Users/User/Desktop/Ambiente de Trabalho/Universidade/Ano 3/Semestre 2/PI/Projeto/repos/pi-assoc-pais/develop/src/components/layout/MainNavbar/NavbarNav/UserActions.js"],"names":["React","Link","Dropdown","DropdownToggle","DropdownMenu","DropdownItem","Collapse","NavItem","NavLink","Row","defaultAvatar","languageCode","parentsParameters","profileLogout","profilePageTitle","profileSettings","profileSettingsAdminSectionTitle","fetchUserDoc","userLogOut","firebase_auth","UserActions","props","state","visible","userName","userPhoto","isAdmin","toggleUserActions","bind","updateNavBarUserPhotoAndName","updateNavBar","_isMounted","setState","currentUser","JSON","parse","window","localStorage","getItem","displayName","NAME","photoURL","PHOTO","ADMIN","console","log","localUser","firebaseUser","stringify","localEmail","EMAIL","email","then","result","error","catch","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { Link } from \"react-router-dom\";\nimport {\n  Dropdown,\n  DropdownToggle,\n  DropdownMenu,\n  DropdownItem,\n  Collapse,\n  NavItem,\n  NavLink,\n  Row,\n} from \"shards-react\";\nimport {\n  defaultAvatar,\n  languageCode,\n  parentsParameters,\n} from \"../../../../utils/general_utils\";\nimport {\n  profileLogout,\n  profilePageTitle,\n  profileSettings, profileSettingsAdminSectionTitle,\n} from \"../../../../utils/page_titles_strings\";\nimport {\n  fetchUserDoc,\n  userLogOut,\n} from \"../../../../firebase_scripts/profile_functions\";\nimport { firebase_auth } from \"../../../../firebase-config\";\n\n\nexport default class UserActions extends React.Component {\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      visible: false,\n      userName: \"ND\",\n      userPhoto: defaultAvatar,\n      isAdmin : false\n    };\n\n    this.toggleUserActions = this.toggleUserActions.bind(this);\n    this.updateNavBarUserPhotoAndName = this.updateNavBarUserPhotoAndName.bind(this);\n    //this.updateNavBarUserPhotoAndNameV2 = this.updateNavBarUserPhotoAndNameV2.bind(this);\n    this.updateNavBar = this.updateNavBar.bind(this);\n  }\n\n  /*********************************** LIFECYCLE ***********************************/\n  componentDidMount() {\n    this._isMounted = true;\n\n    this.updateNavBarUserPhotoAndName();\n    //this.updateNavBarUserPhotoAndNameV2();\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false;\n  }\n\n  toggleUserActions() {\n    this.setState({\n      visible: !this.state.visible,\n    });\n  }\n\n  updateNavBarUserPhotoAndNameV2() {\n    let currentUser = JSON.parse(window.localStorage.getItem(\"userDoc\"));\n    //console.log(\"local User barra: \" + currentUser);\n    if (currentUser != null) {\n      const displayName = currentUser[parentsParameters.NAME[languageCode]];\n      const photoURL = currentUser[parentsParameters.PHOTO[languageCode]];\n      const isAdmin = currentUser[parentsParameters.ADMIN[languageCode]];\n\n      this.setState({ userName: displayName, userPhoto: photoURL, isAdmin : isAdmin });\n    }\n  }\n\n  updateNavBar(){\n    console.log(\"UPDATE NAVBAR\");\n    // check the local storage to see if it's still the same user\n    let localUser = JSON.parse(window.localStorage.getItem(\"userDoc\"));\n\n    // if no information about the user in the LS, then do nothing\n    if(localUser==null){\n      console.log(\"localUser null\");\n      return;\n    }\n\n    const displayName = localUser[parentsParameters.NAME[languageCode]];\n    const photoURL = localUser[parentsParameters.PHOTO[languageCode]];\n    const isAdmin = localUser[parentsParameters.ADMIN[languageCode]];\n    console.log(\"photoURL barra -> \" + photoURL);\n    UserActions.setState({ userName: displayName, userPhoto: photoURL, isAdmin : isAdmin });\n  }\n\n  updateNavBarUserPhotoAndName() {\n    console.log(\"ENTREI NO UPDATE COM CONTEXT\");\n    // check the local storage to see if it's still the same user\n    let localUser = JSON.parse(window.localStorage.getItem(\"userDoc\"));\n    let firebaseUser = firebase_auth.currentUser;\n\n    console.log(\"localUser barra: \" + JSON.stringify(localUser));\n    console.log(\"currentUser: barra\" + JSON.stringify(firebaseUser));\n\n    if (localUser != null && firebaseUser != null) {\n      const localEmail = localUser[parentsParameters.EMAIL[languageCode]];\n      // if the local storage user is old, update the nav bar with the new user (fetching it from firestore)\n      if (localEmail !== firebaseUser.email) {\n        //console.log(\"fetch na barra\");\n        fetchUserDoc(firebaseUser.email)\n          .then((result) => {\n            //console.log(\"Result userDoc: \" + JSON.stringify(result));\n            if (result.error == null) {\n              // no error\n              const displayName = result[parentsParameters.NAME[languageCode]];\n              const photoURL = result[parentsParameters.PHOTO[languageCode]];\n              const isAdmin = result[parentsParameters.ADMIN[languageCode]];\n              this.setState({ userName: displayName, userPhoto: photoURL, isAdmin : isAdmin });\n            }\n          })\n          .catch((error) => {\n            console.log(\"error no fetch da barra: \" + JSON.stringify(error));\n          });\n      } else {\n        //console.log(\"aproveitar o storage\");\n        const displayName = localUser[parentsParameters.NAME[languageCode]];\n        const photoURL = localUser[parentsParameters.PHOTO[languageCode]];\n        const isAdmin = localUser[parentsParameters.ADMIN[languageCode]];\n        this.setState({ userName: displayName, userPhoto: photoURL, isAdmin : isAdmin });\n      }\n    }\n    else if(localUser!=null) {\n      //console.log(\"aproveitar o storage\");\n      const displayName = localUser[parentsParameters.NAME[languageCode]];\n      const photoURL = localUser[parentsParameters.PHOTO[languageCode]];\n      const isAdmin = localUser[parentsParameters.ADMIN[languageCode]];\n      this.setState({ userName: displayName, userPhoto: photoURL, isAdmin : isAdmin });\n    }\n    else if(firebaseUser!=null) {\n      // if this code runs, then there's no user in local storage, so we have to fetch it from Firestore\n      fetchUserDoc(firebaseUser.email)\n        .then((result) => {\n          //console.log(\"Result userDoc: \" + JSON.stringify(result));\n          if (result.error == null) {\n            // no error\n            const displayName = result[parentsParameters.NAME[languageCode]];\n            const photoURL = result[parentsParameters.PHOTO[languageCode]];\n            const isAdmin = result[parentsParameters.ADMIN[languageCode]];\n            this.setState({ userName: displayName, userPhoto: photoURL, isAdmin : isAdmin });\n          }\n        })\n        .catch((error) => {\n          console.log(\"error no fetch da barra: \" + JSON.stringify(error));\n        });\n    }\n  }\n\n  render() {\n    return (\n      <NavItem tag={Dropdown} caret toggle={this.toggleUserActions}>\n        <DropdownToggle caret tag={NavLink} className=\"text-nowrap px-3\">\n          <img\n            className=\"user-avatar rounded-circle mr-2\"\n            src={this.state.userPhoto}\n            alt=\"User photo\"\n          />{\" \"}\n          <span className=\"d-none d-md-inline-block\">\n            {this.state.userName}\n          </span>\n        </DropdownToggle>\n        <Collapse tag={DropdownMenu} right small open={this.state.visible}>\n          <DropdownItem tag={Link} to=\"profile\">\n            <i className=\"material-icons\">&#xE7FD;</i>{\" \"}\n            {profilePageTitle[languageCode]}\n          </DropdownItem>\n          <DropdownItem tag={Link} to=\"profile-settings\">\n            <i className=\"material-icons\">&#xE8B8;</i>{\" \"}\n            {profileSettings[languageCode]}{\" \"}\n            {/*TODO: to export its data and delete account*/}\n          </DropdownItem>\n          {/* render admin option only if the user is admin */}\n          {this.state.isAdmin ?\n            <DropdownItem tag={Link} to=\"admin-settings\">\n              <i className=\"material-icons\">vpn_key</i>{\" \"}\n              {profileSettingsAdminSectionTitle[languageCode]}{\" \"}\n              {/* TODO: export assotiation data */}\n            </DropdownItem>\n          :\n          null}\n          <DropdownItem divider />\n          <DropdownItem tag={Link} onClick={userLogOut} className=\"text-danger\">\n            <i className=\"material-icons text-danger\">&#xE879;</i>{\" \"}\n            {profileLogout[languageCode]}\n          </DropdownItem>\n        </Collapse>\n      </NavItem>\n    );\n  }\n\n}\n"]},"metadata":{},"sourceType":"module"}