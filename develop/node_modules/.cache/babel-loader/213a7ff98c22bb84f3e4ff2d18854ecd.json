{"ast":null,"code":"import _defineProperty from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";\nvar _jsxFileName = \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\src\\\\components\\\\profile\\\\ParentPhotoModal.js\";\n\n/* eslint jsx-a11y/anchor-is-valid: 0 */\nimport React from \"react\";\nimport Modal from \"react-bootstrap/Modal\";\nimport { Button, Col, Row } from \"shards-react\";\nimport { defaultAvatar, languageCode, parentsParameters, showToast, toastTypes } from \"../../utils/general_utils\";\nimport { cancel, saveChanges } from \"../../utils/common_strings\";\nimport { newProfilePhoto } from \"../../utils/page_titles_strings\";\nimport { updateParent, uploadProfilePhoto } from \"../../firebase_scripts/profile_functions\";\nimport { parentUpdatePhotoError, parentUpdatePhotoSuccess } from \"../../utils/messages_strings\";\nimport { firebase_auth, storage, storageRef } from \"../../firebase-config\";\n\nvar ParentPhotoModal = /*#__PURE__*/function (_React$Component) {\n  _inherits(ParentPhotoModal, _React$Component);\n\n  var _super = _createSuper(ParentPhotoModal);\n\n  function ParentPhotoModal(props) {\n    var _this;\n\n    _classCallCheck(this, ParentPhotoModal);\n\n    _this = _super.call(this, props);\n    _this.state = {\n      show: false,\n      newPhoto: _this.props.photo,\n      originalPhoto: _this.props.photo,\n      fileToUpload: null,\n      onSavePhotoButtonsDisabled: false\n    };\n    _this.showModal = _this.showModal.bind(_assertThisInitialized(_this));\n    _this.closeModal = _this.closeModal.bind(_assertThisInitialized(_this));\n    _this.handleChangePhoto = _this.handleChangePhoto.bind(_assertThisInitialized(_this));\n    _this.restoreOriginalPhoto = _this.restoreOriginalPhoto.bind(_assertThisInitialized(_this));\n    _this.closeModalAfterUpdate = _this.closeModalAfterUpdate.bind(_assertThisInitialized(_this));\n    _this.updatePhoto = _this.updatePhoto.bind(_assertThisInitialized(_this));\n    _this.setNewPhoto = _this.setNewPhoto.bind(_assertThisInitialized(_this));\n    _this.enableButtonsWhileUpdating = _this.enableButtonsWhileUpdating.bind(_assertThisInitialized(_this));\n    _this.disableButtonsWhileUpdating = _this.disableButtonsWhileUpdating.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n\n  _createClass(ParentPhotoModal, [{\n    key: \"updatePhoto\",\n    value: function updatePhoto() {\n      var _this2 = this;\n\n      var this_ = this;\n      this_.disableButtonsWhileUpdating(); //console.log(\"state antes do update: \" + JSON.stringify(this.state));\n      // if the photo is the same, do nothing\n\n      if (this.state.newPhoto === this_.state.originalPhoto) {\n        this.closeModal();\n        return;\n      }\n\n      var originalPhotoURL = this_.state.originalPhoto;\n      var newPhotoFile = this_.state.fileToUpload;\n      var closeModalAfterTheUpdate = this_.closeModalAfterUpdate;\n      var myComponentDidMount = this_.props.componentDidMount;\n      var setNewPhotoOnState = this_.setNewPhoto;\n      var restorePhoto = this_.restoreOriginalPhoto;\n      /*\r\n      * this will catch the error of trying to get the reference for the\r\n      * defaultAvatar reference, which does not exist\r\n      * */\n\n      try {\n        var previousPhotoRef = storage.refFromURL(originalPhotoURL); // delete current photo to save the new and not cluttering the storage\n\n        previousPhotoRef.delete().then(function () {\n          var uploadTask = uploadProfilePhoto(newPhotoFile);\n          uploadTask.then(function (snapshot) {\n            // Handle successful uploads on complete\n            // get the download URL\n            snapshot.ref.getDownloadURL().then(function (downloadURL) {\n              var newPhotoField = _defineProperty({}, parentsParameters.PHOTO[languageCode], downloadURL);\n\n              var loggedUser = firebase_auth.currentUser;\n              loggedUser.updateProfile({\n                photoURL: downloadURL\n              }).then(function () {\n                updateParent(loggedUser.email, newPhotoField).then(function (updatedParent) {\n                  var upParentString = JSON.stringify(updatedParent); //console.log(\"updatedParent recebido depois do update foto -> \" + upParentString);\n                  // update user data in localstorage\n\n                  window.localStorage.setItem(\"userDoc\", upParentString);\n                  closeModalAfterTheUpdate();\n                  myComponentDidMount(true);\n                  setNewPhotoOnState(downloadURL); // TODO: update navbar instantaneously\n\n                  showToast(parentUpdatePhotoSuccess[languageCode], 5000, toastTypes.SUCCESS);\n                }).catch(function (error) {\n                  if (Object.keys(error).length !== 0) {\n                    console.log(\"update error: \" + JSON.stringify(error));\n                    showToast(parentUpdatePhotoError[languageCode], 5000, toastTypes.ERROR);\n                    restorePhoto();\n                    this_.enableButtonsWhileUpdating();\n                  }\n                });\n              }).catch(function (error) {\n                console.log(\"update error no firebase user: \" + JSON.stringify(error));\n                showToast(parentUpdatePhotoError[languageCode], 5000, toastTypes.ERROR);\n                restorePhoto();\n                this_.enableButtonsWhileUpdating();\n              });\n            });\n          }).catch(function (error) {\n            console.log(\"Logo upload failed: \" + JSON.stringify(error));\n            showToast(parentUpdatePhotoError[languageCode], 5000, toastTypes.ERROR);\n            this_.restoreOriginalPhoto();\n            this_.enableButtonsWhileUpdating();\n          });\n        }).catch(function () {\n          console.log(\"erro no delete\");\n          showToast(parentUpdatePhotoError[languageCode], 5000, toastTypes.ERROR);\n\n          _this2.restoreOriginalPhoto();\n\n          this_.enableButtonsWhileUpdating();\n        });\n      } catch (e) {\n        var uploadTask = uploadProfilePhoto(newPhotoFile);\n        uploadTask.then(function (snapshot) {\n          // Handle successful uploads on complete\n          // get the download URL\n          snapshot.ref.getDownloadURL().then(function (downloadURL) {\n            var newPhotoField = _defineProperty({}, parentsParameters.PHOTO[languageCode], downloadURL);\n\n            var loggedUser = firebase_auth.currentUser;\n            loggedUser.updateProfile({\n              photoURL: downloadURL\n            }).then(function () {\n              updateParent(firebase_auth.currentUser.email, newPhotoField).then(function (updatedParent) {\n                var upParentString = JSON.stringify(updatedParent);\n                console.log(\"updatedParent recebido depois do update foto -> \" + upParentString); // update user data in localstorage\n\n                window.localStorage.setItem(\"userDoc\", upParentString);\n                closeModalAfterTheUpdate();\n                myComponentDidMount(true);\n                setNewPhotoOnState(); // TODO: update navbar instantaneously\n\n                showToast(parentUpdatePhotoSuccess[languageCode], 5000, toastTypes.SUCCESS);\n              }).catch(function (error) {\n                if (Object.keys(error).length !== 0) {\n                  console.log(\"update error: \" + JSON.stringify(error));\n                  showToast(parentUpdatePhotoError[languageCode], 5000, toastTypes.ERROR);\n                  restorePhoto();\n                  this_.enableButtonsWhileUpdating();\n                }\n              });\n            }).catch(function (error) {\n              console.log(\"update error no firebase user: \" + JSON.stringify(error));\n              showToast(parentUpdatePhotoError[languageCode], 5000, toastTypes.ERROR);\n              restorePhoto();\n              this_.enableButtonsWhileUpdating();\n            });\n          });\n        }).catch(function (error) {\n          console.log(\"Photo upload failed: \" + JSON.stringify(error));\n          showToast(parentUpdatePhotoError[languageCode], 5000, toastTypes.ERROR);\n          this_.restoreOriginalPhoto();\n          this_.enableButtonsWhileUpdating();\n        });\n      }\n    }\n  }, {\n    key: \"handleChangePhoto\",\n    value: function handleChangePhoto(e) {\n      var imageFile = e.target.files[0];\n\n      if (imageFile != null) {\n        var imageTempUrl = URL.createObjectURL(imageFile);\n        this.setState({\n          fileToUpload: imageFile,\n          newPhoto: imageTempUrl\n        });\n      }\n    }\n  }, {\n    key: \"showModal\",\n    value: function showModal() {\n      this.enableButtonsWhileUpdating();\n      this.setState({\n        show: true\n      });\n    }\n  }, {\n    key: \"closeModal\",\n    value: function closeModal() {\n      this.restoreOriginalPhoto();\n      this.setState({\n        show: false\n      });\n      this.enableButtonsWhileUpdating();\n    }\n  }, {\n    key: \"closeModalAfterUpdate\",\n    value: function closeModalAfterUpdate() {\n      this.setState({\n        show: false,\n        fileToUpload: null\n      });\n      this.enableButtonsWhileUpdating();\n    }\n  }, {\n    key: \"restoreOriginalPhoto\",\n    value: function restoreOriginalPhoto() {\n      var originalPhoto = this.state.originalPhoto;\n      this.setState({\n        newPhoto: originalPhoto\n      });\n    }\n  }, {\n    key: \"setNewPhoto\",\n    value: function setNewPhoto(newPhotoURL) {\n      this.setState({\n        originalPhoto: newPhotoURL\n      });\n      this.setState({\n        newPhoto: newPhotoURL\n      });\n    }\n  }, {\n    key: \"disableButtonsWhileUpdating\",\n    value: function disableButtonsWhileUpdating() {\n      this.setState({\n        onSavePhotoButtonsDisabled: true\n      });\n    }\n  }, {\n    key: \"enableButtonsWhileUpdating\",\n    value: function enableButtonsWhileUpdating() {\n      this.setState({\n        onSavePhotoButtonsDisabled: false\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      //console.log(\"state a render -> \" + JSON.stringify(this.state));\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Button, {\n        size: \"sm\",\n        theme: \"light\",\n        id: \"new_case\",\n        onClick: this.showModal,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 239,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        className: \"material-icons md-24\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 245,\n          columnNumber: 11\n        }\n      }, \"add_a_photo\")), /*#__PURE__*/React.createElement(Modal, {\n        show: this.state.show,\n        onHide: this.closeModal,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 249,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(Modal.Header, {\n        closeButton: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 250,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(Modal.Title, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 251,\n          columnNumber: 13\n        }\n      }, newProfilePhoto[languageCode])), /*#__PURE__*/React.createElement(Modal.Body, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 255,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(Col, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(Row, {\n        style: {\n          justifyContent: \"center\",\n          flexDirection: \"column\",\n          alignItems: \"center\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 257,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          width: \"110px\",\n          height: \"110px\",\n          backgroundImage: \"url(\" + this.state.newPhoto + \")\",\n          backgroundPosition: \"center\",\n          borderRadius: \"50%\",\n          backgroundSize: \"cover\",\n          backgroundRepeat: \"no-repeat\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 264,\n          columnNumber: 17\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          margin: \"10px\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 284,\n          columnNumber: 15\n        }\n      }), /*#__PURE__*/React.createElement(Row, {\n        style: {\n          justifyContent: \"center\",\n          flexDirection: \"column\",\n          alignItems: \"center\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 285,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(Row, {\n        style: {\n          justifyContent: \"center\",\n          alignItems: \"center\",\n          marginBottom: \"5px\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 292,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        size: \"sm\",\n        theme: \"light\",\n        id: \"add-photo-button\",\n        disabled: this.state.onSavePhotoButtonsDisabled,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 293,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        htmlFor: \"file-upload-input\",\n        style: {\n          cursor: \"pointer\",\n          padding: \"0px\",\n          margin: \"0px\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 299,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        className: \"material-icons md-24\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 300,\n          columnNumber: 23\n        }\n      }, \"add_a_photo\"))), /*#__PURE__*/React.createElement(\"input\", {\n        id: \"file-upload-input\",\n        type: \"file\",\n        accept: \"image/png, image/jpeg\",\n        style: {\n          display: \"none\",\n          margin: \"0px\"\n        },\n        onChange: this.handleChangePhoto,\n        disabled: this.state.onSavePhotoButtonsDisabled,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 303,\n          columnNumber: 19\n        }\n      }))))), /*#__PURE__*/React.createElement(Modal.Footer, {\n        style: {\n          justifyContent: \"left\",\n          flexDirection: \"column\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 315,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(Row, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 318,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        style: {\n          marginRight: \"40px\"\n        },\n        theme: \"danger\",\n        onClick: this.closeModal,\n        disabled: this.state.onSavePhotoButtonsDisabled,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 319,\n          columnNumber: 15\n        }\n      }, cancel[languageCode]), /*#__PURE__*/React.createElement(Button, {\n        style: {\n          marginLeft: \"40px\"\n        },\n        className: \"float-right\",\n        theme: \"success\",\n        onClick: this.updatePhoto,\n        disabled: this.state.onSavePhotoButtonsDisabled,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 322,\n          columnNumber: 15\n        }\n      }, saveChanges[languageCode])))));\n    }\n  }]);\n\n  return ParentPhotoModal;\n}(React.Component);\n\nexport default ParentPhotoModal;","map":{"version":3,"sources":["C:/Users/User/Desktop/Ambiente de Trabalho/Universidade/Ano 3/Semestre 2/PI/Projeto/repos/pi-assoc-pais/develop/src/components/profile/ParentPhotoModal.js"],"names":["React","Modal","Button","Col","Row","defaultAvatar","languageCode","parentsParameters","showToast","toastTypes","cancel","saveChanges","newProfilePhoto","updateParent","uploadProfilePhoto","parentUpdatePhotoError","parentUpdatePhotoSuccess","firebase_auth","storage","storageRef","ParentPhotoModal","props","state","show","newPhoto","photo","originalPhoto","fileToUpload","onSavePhotoButtonsDisabled","showModal","bind","closeModal","handleChangePhoto","restoreOriginalPhoto","closeModalAfterUpdate","updatePhoto","setNewPhoto","enableButtonsWhileUpdating","disableButtonsWhileUpdating","this_","originalPhotoURL","newPhotoFile","closeModalAfterTheUpdate","myComponentDidMount","componentDidMount","setNewPhotoOnState","restorePhoto","previousPhotoRef","refFromURL","delete","then","uploadTask","snapshot","ref","getDownloadURL","downloadURL","newPhotoField","PHOTO","loggedUser","currentUser","updateProfile","photoURL","email","updatedParent","upParentString","JSON","stringify","window","localStorage","setItem","SUCCESS","catch","error","Object","keys","length","console","log","ERROR","e","imageFile","target","files","imageTempUrl","URL","createObjectURL","setState","newPhotoURL","justifyContent","flexDirection","alignItems","width","height","backgroundImage","backgroundPosition","borderRadius","backgroundSize","backgroundRepeat","margin","marginBottom","cursor","padding","display","marginRight","marginLeft","Component"],"mappings":";;;;;;;;AAAA;AAEA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,KAAP,MAAkB,uBAAlB;AACA,SACEC,MADF,EAEEC,GAFF,EAGEC,GAHF,QAIO,cAJP;AAKA,SACEC,aADF,EAEEC,YAFF,EAEgBC,iBAFhB,EAEmCC,SAFnC,EAGEC,UAHF,QAIO,2BAJP;AAKA,SACEC,MADF,EAEEC,WAFF,QAGO,4BAHP;AAIA,SAAQC,eAAR,QAA8B,iCAA9B;AACA,SACEC,YADF,EAEEC,kBAFF,QAGO,0CAHP;AAIA,SACEC,sBADF,EAC0BC,wBAD1B,QAEO,8BAFP;AAGA,SAAQC,aAAR,EAAuBC,OAAvB,EAAgCC,UAAhC,QAAiD,uBAAjD;;IAEMC,gB;;;;;AACJ,4BAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,8BAAMA,KAAN;AAEA,UAAKC,KAAL,GAAa;AACXC,MAAAA,IAAI,EAAE,KADK;AAEXC,MAAAA,QAAQ,EAAG,MAAKH,KAAL,CAAWI,KAFX;AAGXC,MAAAA,aAAa,EAAG,MAAKL,KAAL,CAAWI,KAHhB;AAIXE,MAAAA,YAAY,EAAG,IAJJ;AAKXC,MAAAA,0BAA0B,EAAG;AALlB,KAAb;AAQA,UAAKC,SAAL,GAAiB,MAAKA,SAAL,CAAeC,IAAf,+BAAjB;AACA,UAAKC,UAAL,GAAkB,MAAKA,UAAL,CAAgBD,IAAhB,+BAAlB;AACA,UAAKE,iBAAL,GAAyB,MAAKA,iBAAL,CAAuBF,IAAvB,+BAAzB;AACA,UAAKG,oBAAL,GAA4B,MAAKA,oBAAL,CAA0BH,IAA1B,+BAA5B;AACA,UAAKI,qBAAL,GAA6B,MAAKA,qBAAL,CAA2BJ,IAA3B,+BAA7B;AACA,UAAKK,WAAL,GAAmB,MAAKA,WAAL,CAAiBL,IAAjB,+BAAnB;AACA,UAAKM,WAAL,GAAmB,MAAKA,WAAL,CAAiBN,IAAjB,+BAAnB;AAEA,UAAKO,0BAAL,GAAkC,MAAKA,0BAAL,CAAgCP,IAAhC,+BAAlC;AACA,UAAKQ,2BAAL,GAAmC,MAAKA,2BAAL,CAAiCR,IAAjC,+BAAnC;AApBiB;AAsBlB;;;;kCAEY;AAAA;;AACX,UAAMS,KAAK,GAAG,IAAd;AACAA,MAAAA,KAAK,CAACD,2BAAN,GAFW,CAGX;AAEA;;AACA,UAAG,KAAKhB,KAAL,CAAWE,QAAX,KAAsBe,KAAK,CAACjB,KAAN,CAAYI,aAArC,EAAmD;AACjD,aAAKK,UAAL;AACA;AACD;;AAED,UAAMS,gBAAgB,GAAGD,KAAK,CAACjB,KAAN,CAAYI,aAArC;AACA,UAAMe,YAAY,GAAGF,KAAK,CAACjB,KAAN,CAAYK,YAAjC;AAEA,UAAMe,wBAAwB,GAAGH,KAAK,CAACL,qBAAvC;AACA,UAAMS,mBAAmB,GAAGJ,KAAK,CAAClB,KAAN,CAAYuB,iBAAxC;AACA,UAAMC,kBAAkB,GAAGN,KAAK,CAACH,WAAjC;AACA,UAAMU,YAAY,GAAGP,KAAK,CAACN,oBAA3B;AAEA;;;;;AAIA,UAAG;AACD,YAAIc,gBAAgB,GAAG7B,OAAO,CAAC8B,UAAR,CAAmBR,gBAAnB,CAAvB,CADC,CAED;;AACAO,QAAAA,gBAAgB,CAACE,MAAjB,GACGC,IADH,CACQ,YAAM;AACV,cAAMC,UAAU,GAAGrC,kBAAkB,CAAC2B,YAAD,CAArC;AACAU,UAAAA,UAAU,CACPD,IADH,CACQ,UAACE,QAAD,EAAc;AAClB;AACA;AACAA,YAAAA,QAAQ,CAACC,GAAT,CAAaC,cAAb,GAA8BJ,IAA9B,CAAmC,UAAUK,WAAV,EAAuB;AACxD,kBAAMC,aAAa,uBAAKjD,iBAAiB,CAACkD,KAAlB,CAAwBnD,YAAxB,CAAL,EAA8CiD,WAA9C,CAAnB;;AACA,kBAAMG,UAAU,GAAGzC,aAAa,CAAC0C,WAAjC;AAEAD,cAAAA,UAAU,CAACE,aAAX,CAAyB;AACvBC,gBAAAA,QAAQ,EAAEN;AADa,eAAzB,EAEGL,IAFH,CAEQ,YAAW;AACjBrC,gBAAAA,YAAY,CAAC6C,UAAU,CAACI,KAAZ,EAAmBN,aAAnB,CAAZ,CACGN,IADH,CACQ,UAACa,aAAD,EAAmB;AACvB,sBAAMC,cAAc,GAAGC,IAAI,CAACC,SAAL,CAAeH,aAAf,CAAvB,CADuB,CAEvB;AACA;;AACAI,kBAAAA,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,SAA5B,EAAuCL,cAAvC;AACAtB,kBAAAA,wBAAwB;AACxBC,kBAAAA,mBAAmB,CAAC,IAAD,CAAnB;AACAE,kBAAAA,kBAAkB,CAACU,WAAD,CAAlB,CAPuB,CAQvB;;AACA/C,kBAAAA,SAAS,CAACQ,wBAAwB,CAACV,YAAD,CAAzB,EAAyC,IAAzC,EAA+CG,UAAU,CAAC6D,OAA1D,CAAT;AACD,iBAXH,EAYGC,KAZH,CAYS,UAACC,KAAD,EAAW;AAChB,sBAAGC,MAAM,CAACC,IAAP,CAAYF,KAAZ,EAAmBG,MAAnB,KAA4B,CAA/B,EAAiC;AAC/BC,oBAAAA,OAAO,CAACC,GAAR,CAAY,mBAAmBZ,IAAI,CAACC,SAAL,CAAeM,KAAf,CAA/B;AACAhE,oBAAAA,SAAS,CAACO,sBAAsB,CAACT,YAAD,CAAvB,EAAuC,IAAvC,EAA6CG,UAAU,CAACqE,KAAxD,CAAT;AACAhC,oBAAAA,YAAY;AACZP,oBAAAA,KAAK,CAACF,0BAAN;AACD;AACF,iBAnBH;AAoBD,eAvBD,EAuBGkC,KAvBH,CAuBS,UAASC,KAAT,EAAgB;AACvBI,gBAAAA,OAAO,CAACC,GAAR,CAAY,oCAAoCZ,IAAI,CAACC,SAAL,CAAeM,KAAf,CAAhD;AACAhE,gBAAAA,SAAS,CAACO,sBAAsB,CAACT,YAAD,CAAvB,EAAuC,IAAvC,EAA6CG,UAAU,CAACqE,KAAxD,CAAT;AACAhC,gBAAAA,YAAY;AACZP,gBAAAA,KAAK,CAACF,0BAAN;AACD,eA5BD;AA8BD,aAlCD;AAmCD,WAvCH,EAwCGkC,KAxCH,CAwCS,UAACC,KAAD,EAAW;AAChBI,YAAAA,OAAO,CAACC,GAAR,CAAY,yBAAyBZ,IAAI,CAACC,SAAL,CAAeM,KAAf,CAArC;AACAhE,YAAAA,SAAS,CAACO,sBAAsB,CAACT,YAAD,CAAvB,EAAuC,IAAvC,EAA6CG,UAAU,CAACqE,KAAxD,CAAT;AACAvC,YAAAA,KAAK,CAACN,oBAAN;AACAM,YAAAA,KAAK,CAACF,0BAAN;AACD,WA7CH;AA8CD,SAjDH,EAkDGkC,KAlDH,CAkDS,YAAM;AACXK,UAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ;AACArE,UAAAA,SAAS,CAACO,sBAAsB,CAACT,YAAD,CAAvB,EAAuC,IAAvC,EAA6CG,UAAU,CAACqE,KAAxD,CAAT;;AACA,UAAA,MAAI,CAAC7C,oBAAL;;AACAM,UAAAA,KAAK,CAACF,0BAAN;AACD,SAvDH;AAwDD,OA3DD,CA4DA,OAAO0C,CAAP,EAAU;AACR,YAAM5B,UAAU,GAAGrC,kBAAkB,CAAC2B,YAAD,CAArC;AACAU,QAAAA,UAAU,CACPD,IADH,CACQ,UAACE,QAAD,EAAc;AAClB;AACA;AACAA,UAAAA,QAAQ,CAACC,GAAT,CAAaC,cAAb,GAA8BJ,IAA9B,CAAmC,UAAUK,WAAV,EAAuB;AACxD,gBAAMC,aAAa,uBAAKjD,iBAAiB,CAACkD,KAAlB,CAAwBnD,YAAxB,CAAL,EAA8CiD,WAA9C,CAAnB;;AACA,gBAAMG,UAAU,GAAGzC,aAAa,CAAC0C,WAAjC;AAEAD,YAAAA,UAAU,CAACE,aAAX,CAAyB;AACvBC,cAAAA,QAAQ,EAAEN;AADa,aAAzB,EAEGL,IAFH,CAEQ,YAAW;AACjBrC,cAAAA,YAAY,CAACI,aAAa,CAAC0C,WAAd,CAA0BG,KAA3B,EAAkCN,aAAlC,CAAZ,CACGN,IADH,CACQ,UAACa,aAAD,EAAmB;AACvB,oBAAMC,cAAc,GAAGC,IAAI,CAACC,SAAL,CAAeH,aAAf,CAAvB;AACAa,gBAAAA,OAAO,CAACC,GAAR,CAAY,qDAAqDb,cAAjE,EAFuB,CAGvB;;AACAG,gBAAAA,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,SAA5B,EAAuCL,cAAvC;AACAtB,gBAAAA,wBAAwB;AACxBC,gBAAAA,mBAAmB,CAAC,IAAD,CAAnB;AACAE,gBAAAA,kBAAkB,GAPK,CAQvB;;AACArC,gBAAAA,SAAS,CAACQ,wBAAwB,CAACV,YAAD,CAAzB,EAAyC,IAAzC,EAA+CG,UAAU,CAAC6D,OAA1D,CAAT;AACD,eAXH,EAYGC,KAZH,CAYS,UAACC,KAAD,EAAW;AAChB,oBAAGC,MAAM,CAACC,IAAP,CAAYF,KAAZ,EAAmBG,MAAnB,KAA4B,CAA/B,EAAiC;AAC/BC,kBAAAA,OAAO,CAACC,GAAR,CAAY,mBAAmBZ,IAAI,CAACC,SAAL,CAAeM,KAAf,CAA/B;AACAhE,kBAAAA,SAAS,CAACO,sBAAsB,CAACT,YAAD,CAAvB,EAAuC,IAAvC,EAA6CG,UAAU,CAACqE,KAAxD,CAAT;AACAhC,kBAAAA,YAAY;AACZP,kBAAAA,KAAK,CAACF,0BAAN;AACD;AACF,eAnBH;AAoBD,aAvBD,EAuBGkC,KAvBH,CAuBS,UAASC,KAAT,EAAgB;AACvBI,cAAAA,OAAO,CAACC,GAAR,CAAY,oCAAoCZ,IAAI,CAACC,SAAL,CAAeM,KAAf,CAAhD;AACAhE,cAAAA,SAAS,CAACO,sBAAsB,CAACT,YAAD,CAAvB,EAAuC,IAAvC,EAA6CG,UAAU,CAACqE,KAAxD,CAAT;AACAhC,cAAAA,YAAY;AACZP,cAAAA,KAAK,CAACF,0BAAN;AACD,aA5BD;AA6BD,WAjCD;AAkCD,SAtCH,EAuCGkC,KAvCH,CAuCS,UAACC,KAAD,EAAW;AAChBI,UAAAA,OAAO,CAACC,GAAR,CAAY,0BAA0BZ,IAAI,CAACC,SAAL,CAAeM,KAAf,CAAtC;AACAhE,UAAAA,SAAS,CAACO,sBAAsB,CAACT,YAAD,CAAvB,EAAuC,IAAvC,EAA6CG,UAAU,CAACqE,KAAxD,CAAT;AACAvC,UAAAA,KAAK,CAACN,oBAAN;AACAM,UAAAA,KAAK,CAACF,0BAAN;AACD,SA5CH;AA6CD;AAEF;;;sCAGiB0C,C,EAAG;AACnB,UAAMC,SAAS,GAAGD,CAAC,CAACE,MAAF,CAASC,KAAT,CAAe,CAAf,CAAlB;;AACA,UAAGF,SAAS,IAAE,IAAd,EAAmB;AACjB,YAAMG,YAAY,GAAGC,GAAG,CAACC,eAAJ,CAAoBL,SAApB,CAArB;AACA,aAAKM,QAAL,CAAc;AAAC3D,UAAAA,YAAY,EAAGqD,SAAhB;AAA2BxD,UAAAA,QAAQ,EAAG2D;AAAtC,SAAd;AACD;AACF;;;gCAGW;AACV,WAAK9C,0BAAL;AACA,WAAKiD,QAAL,CAAc;AAAE/D,QAAAA,IAAI,EAAE;AAAR,OAAd;AACD;;;iCAEY;AACX,WAAKU,oBAAL;AACA,WAAKqD,QAAL,CAAc;AAAE/D,QAAAA,IAAI,EAAE;AAAR,OAAd;AACA,WAAKc,0BAAL;AACD;;;4CAEuB;AACtB,WAAKiD,QAAL,CAAc;AAAE/D,QAAAA,IAAI,EAAE,KAAR;AAAgBI,QAAAA,YAAY,EAAG;AAA/B,OAAd;AACA,WAAKU,0BAAL;AACD;;;2CAGsB;AACrB,UAAMX,aAAa,GAAG,KAAKJ,KAAL,CAAWI,aAAjC;AACA,WAAK4D,QAAL,CAAc;AAAE9D,QAAAA,QAAQ,EAAEE;AAAZ,OAAd;AACD;;;gCAGW6D,W,EAAY;AACtB,WAAKD,QAAL,CAAc;AAAE5D,QAAAA,aAAa,EAAE6D;AAAjB,OAAd;AACA,WAAKD,QAAL,CAAc;AAAE9D,QAAAA,QAAQ,EAAE+D;AAAZ,OAAd;AACD;;;kDAE4B;AAC3B,WAAKD,QAAL,CAAc;AAAE1D,QAAAA,0BAA0B,EAAE;AAA9B,OAAd;AACD;;;iDAE2B;AAC1B,WAAK0D,QAAL,CAAc;AAAE1D,QAAAA,0BAA0B,EAAE;AAA9B,OAAd;AACD;;;6BAGQ;AACP;AACA,0BACE,uDACE,oBAAC,MAAD;AACE,QAAA,IAAI,EAAC,IADP;AAEE,QAAA,KAAK,EAAC,OAFR;AAGE,QAAA,EAAE,EAAC,UAHL;AAIE,QAAA,OAAO,EAAE,KAAKC,SAJhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAME;AAAM,QAAA,SAAS,EAAC,sBAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBANF,CADF,eAWE,oBAAC,KAAD;AAAO,QAAA,IAAI,EAAE,KAAKP,KAAL,CAAWC,IAAxB;AAA8B,QAAA,MAAM,EAAE,KAAKQ,UAA3C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE,oBAAC,KAAD,CAAO,MAAP;AAAc,QAAA,WAAW,MAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE,oBAAC,KAAD,CAAO,KAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACGnB,eAAe,CAACN,YAAD,CADlB,CADF,CADF,eAME,oBAAC,KAAD,CAAO,IAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE,oBAAC,GAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE,oBAAC,GAAD;AACE,QAAA,KAAK,EAAE;AACLkF,UAAAA,cAAc,EAAE,QADX;AAELC,UAAAA,aAAa,EAAE,QAFV;AAGLC,UAAAA,UAAU,EAAE;AAHP,SADT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAOE;AAAK,QAAA,KAAK,EAAE;AACVC,UAAAA,KAAK,EAAG,OADE;AAEVC,UAAAA,MAAM,EAAE,OAFE;AAGVC,UAAAA,eAAe,EAAE,SAAS,KAAKvE,KAAL,CAAWE,QAApB,GAA+B,GAHtC;AAIVsE,UAAAA,kBAAkB,EAAG,QAJX;AAKVC,UAAAA,YAAY,EAAE,KALJ;AAMVC,UAAAA,cAAc,EAAE,OANN;AAOVC,UAAAA,gBAAgB,EAAE;AAPR,SAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAPF,CADF,eA4BE;AAAK,QAAA,KAAK,EAAE;AAAEC,UAAAA,MAAM,EAAE;AAAV,SAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QA5BF,eA6BE,oBAAC,GAAD;AACE,QAAA,KAAK,EAAE;AACLV,UAAAA,cAAc,EAAE,QADX;AAELC,UAAAA,aAAa,EAAE,QAFV;AAGLC,UAAAA,UAAU,EAAE;AAHP,SADT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAOE,oBAAC,GAAD;AAAK,QAAA,KAAK,EAAE;AAACF,UAAAA,cAAc,EAAE,QAAjB;AAA2BE,UAAAA,UAAU,EAAE,QAAvC;AAAiDS,UAAAA,YAAY,EAAE;AAA/D,SAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE,oBAAC,MAAD;AACE,QAAA,IAAI,EAAC,IADP;AAEE,QAAA,KAAK,EAAC,OAFR;AAGE,QAAA,EAAE,EAAC,kBAHL;AAIE,QAAA,QAAQ,EAAE,KAAK7E,KAAL,CAAWM,0BAJvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAME;AAAO,QAAA,OAAO,EAAC,mBAAf;AAAmC,QAAA,KAAK,EAAE;AAACwE,UAAAA,MAAM,EAAE,SAAT;AAAoBC,UAAAA,OAAO,EAAC,KAA5B;AAAmCH,UAAAA,MAAM,EAAG;AAA5C,SAA1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAM,QAAA,SAAS,EAAC,sBAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBADF,CANF,CADF,eAWE;AACE,QAAA,EAAE,EAAC,mBADL;AAEE,QAAA,IAAI,EAAC,MAFP;AAGE,QAAA,MAAM,EAAC,uBAHT;AAIE,QAAA,KAAK,EAAE;AAACI,UAAAA,OAAO,EAAE,MAAV;AAAkBJ,UAAAA,MAAM,EAAE;AAA1B,SAJT;AAKE,QAAA,QAAQ,EAAE,KAAKlE,iBALjB;AAME,QAAA,QAAQ,EAAE,KAAKV,KAAL,CAAWM,0BANvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAXF,CAPF,CA7BF,CADF,CANF,eAkEE,oBAAC,KAAD,CAAO,MAAP;AACE,QAAA,KAAK,EAAE;AAAE4D,UAAAA,cAAc,EAAE,MAAlB;AAA0BC,UAAAA,aAAa,EAAE;AAAzC,SADT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAGE,oBAAC,GAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE,oBAAC,MAAD;AAAQ,QAAA,KAAK,EAAE;AAACc,UAAAA,WAAW,EAAC;AAAb,SAAf;AAAqC,QAAA,KAAK,EAAC,QAA3C;AAAoD,QAAA,OAAO,EAAE,KAAKxE,UAAlE;AAA8E,QAAA,QAAQ,EAAE,KAAKT,KAAL,CAAWM,0BAAnG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACGlB,MAAM,CAACJ,YAAD,CADT,CADF,eAIE,oBAAC,MAAD;AAAQ,QAAA,KAAK,EAAE;AAACkG,UAAAA,UAAU,EAAC;AAAZ,SAAf;AAAoC,QAAA,SAAS,EAAC,aAA9C;AAA4D,QAAA,KAAK,EAAC,SAAlE;AAA4E,QAAA,OAAO,EAAE,KAAKrE,WAA1F;AAAuG,QAAA,QAAQ,EAAE,KAAKb,KAAL,CAAWM,0BAA5H;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACGjB,WAAW,CAACL,YAAD,CADd,CAJF,CAHF,CAlEF,CAXF,CADF;AA6FD;;;;EA7S4BN,KAAK,CAACyG,S;;AAgTrC,eAAerF,gBAAf","sourcesContent":["/* eslint jsx-a11y/anchor-is-valid: 0 */\r\n\r\nimport React from \"react\";\r\nimport Modal from \"react-bootstrap/Modal\";\r\nimport {\r\n  Button,\r\n  Col,\r\n  Row,\r\n} from \"shards-react\";\r\nimport {\r\n  defaultAvatar,\r\n  languageCode, parentsParameters, showToast,\r\n  toastTypes,\r\n} from \"../../utils/general_utils\";\r\nimport {\r\n  cancel,\r\n  saveChanges\r\n} from \"../../utils/common_strings\";\r\nimport {newProfilePhoto} from \"../../utils/page_titles_strings\";\r\nimport {\r\n  updateParent,\r\n  uploadProfilePhoto\r\n} from \"../../firebase_scripts/profile_functions\";\r\nimport {\r\n  parentUpdatePhotoError, parentUpdatePhotoSuccess,\r\n} from \"../../utils/messages_strings\";\r\nimport {firebase_auth, storage, storageRef} from \"../../firebase-config\";\r\n\r\nclass ParentPhotoModal extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      show: false,\r\n      newPhoto : this.props.photo,\r\n      originalPhoto : this.props.photo,\r\n      fileToUpload : null,\r\n      onSavePhotoButtonsDisabled : false\r\n    };\r\n\r\n    this.showModal = this.showModal.bind(this);\r\n    this.closeModal = this.closeModal.bind(this);\r\n    this.handleChangePhoto = this.handleChangePhoto.bind(this);\r\n    this.restoreOriginalPhoto = this.restoreOriginalPhoto.bind(this);\r\n    this.closeModalAfterUpdate = this.closeModalAfterUpdate.bind(this);\r\n    this.updatePhoto = this.updatePhoto.bind(this);\r\n    this.setNewPhoto = this.setNewPhoto.bind(this);\r\n\r\n    this.enableButtonsWhileUpdating = this.enableButtonsWhileUpdating.bind(this);\r\n    this.disableButtonsWhileUpdating = this.disableButtonsWhileUpdating.bind(this);\r\n\r\n  }\r\n\r\n  updatePhoto(){\r\n    const this_ = this;\r\n    this_.disableButtonsWhileUpdating();\r\n    //console.log(\"state antes do update: \" + JSON.stringify(this.state));\r\n\r\n    // if the photo is the same, do nothing\r\n    if(this.state.newPhoto===this_.state.originalPhoto){\r\n      this.closeModal();\r\n      return;\r\n    }\r\n\r\n    const originalPhotoURL = this_.state.originalPhoto;\r\n    const newPhotoFile = this_.state.fileToUpload;\r\n\r\n    const closeModalAfterTheUpdate = this_.closeModalAfterUpdate;\r\n    const myComponentDidMount = this_.props.componentDidMount;\r\n    const setNewPhotoOnState = this_.setNewPhoto;\r\n    const restorePhoto = this_.restoreOriginalPhoto;\r\n\r\n    /*\r\n    * this will catch the error of trying to get the reference for the\r\n    * defaultAvatar reference, which does not exist\r\n    * */\r\n    try{\r\n      let previousPhotoRef = storage.refFromURL(originalPhotoURL);\r\n      // delete current photo to save the new and not cluttering the storage\r\n      previousPhotoRef.delete()\r\n        .then(() => {\r\n          const uploadTask = uploadProfilePhoto(newPhotoFile);\r\n          uploadTask\r\n            .then((snapshot) => {\r\n              // Handle successful uploads on complete\r\n              // get the download URL\r\n              snapshot.ref.getDownloadURL().then(function (downloadURL) {\r\n                const newPhotoField = {[parentsParameters.PHOTO[languageCode]] : downloadURL};\r\n                const loggedUser = firebase_auth.currentUser;\r\n\r\n                loggedUser.updateProfile({\r\n                  photoURL: downloadURL\r\n                }).then(function() {\r\n                  updateParent(loggedUser.email, newPhotoField)\r\n                    .then((updatedParent) => {\r\n                      const upParentString = JSON.stringify(updatedParent);\r\n                      //console.log(\"updatedParent recebido depois do update foto -> \" + upParentString);\r\n                      // update user data in localstorage\r\n                      window.localStorage.setItem(\"userDoc\", upParentString);\r\n                      closeModalAfterTheUpdate();\r\n                      myComponentDidMount(true);\r\n                      setNewPhotoOnState(downloadURL);\r\n                      // TODO: update navbar instantaneously\r\n                      showToast(parentUpdatePhotoSuccess[languageCode], 5000, toastTypes.SUCCESS);\r\n                    })\r\n                    .catch((error) => {\r\n                      if(Object.keys(error).length!==0){\r\n                        console.log(\"update error: \" + JSON.stringify(error));\r\n                        showToast(parentUpdatePhotoError[languageCode], 5000, toastTypes.ERROR);\r\n                        restorePhoto();\r\n                        this_.enableButtonsWhileUpdating();\r\n                      }\r\n                    });\r\n                }).catch(function(error) {\r\n                  console.log(\"update error no firebase user: \" + JSON.stringify(error));\r\n                  showToast(parentUpdatePhotoError[languageCode], 5000, toastTypes.ERROR);\r\n                  restorePhoto();\r\n                  this_.enableButtonsWhileUpdating();\r\n                });\r\n\r\n              });\r\n            })\r\n            .catch((error) => {\r\n              console.log(\"Logo upload failed: \" + JSON.stringify(error));\r\n              showToast(parentUpdatePhotoError[languageCode], 5000, toastTypes.ERROR);\r\n              this_.restoreOriginalPhoto();\r\n              this_.enableButtonsWhileUpdating();\r\n            });\r\n        })\r\n        .catch(() => {\r\n          console.log(\"erro no delete\");\r\n          showToast(parentUpdatePhotoError[languageCode], 5000, toastTypes.ERROR);\r\n          this.restoreOriginalPhoto();\r\n          this_.enableButtonsWhileUpdating();\r\n        });\r\n    }\r\n    catch (e) {\r\n      const uploadTask = uploadProfilePhoto(newPhotoFile);\r\n      uploadTask\r\n        .then((snapshot) => {\r\n          // Handle successful uploads on complete\r\n          // get the download URL\r\n          snapshot.ref.getDownloadURL().then(function (downloadURL) {\r\n            const newPhotoField = {[parentsParameters.PHOTO[languageCode]] : downloadURL};\r\n            const loggedUser = firebase_auth.currentUser;\r\n\r\n            loggedUser.updateProfile({\r\n              photoURL: downloadURL\r\n            }).then(function() {\r\n              updateParent(firebase_auth.currentUser.email, newPhotoField)\r\n                .then((updatedParent) => {\r\n                  const upParentString = JSON.stringify(updatedParent);\r\n                  console.log(\"updatedParent recebido depois do update foto -> \" + upParentString);\r\n                  // update user data in localstorage\r\n                  window.localStorage.setItem(\"userDoc\", upParentString);\r\n                  closeModalAfterTheUpdate();\r\n                  myComponentDidMount(true);\r\n                  setNewPhotoOnState();\r\n                  // TODO: update navbar instantaneously\r\n                  showToast(parentUpdatePhotoSuccess[languageCode], 5000, toastTypes.SUCCESS);\r\n                })\r\n                .catch((error) => {\r\n                  if(Object.keys(error).length!==0){\r\n                    console.log(\"update error: \" + JSON.stringify(error));\r\n                    showToast(parentUpdatePhotoError[languageCode], 5000, toastTypes.ERROR);\r\n                    restorePhoto();\r\n                    this_.enableButtonsWhileUpdating();\r\n                  }\r\n                });\r\n            }).catch(function(error) {\r\n              console.log(\"update error no firebase user: \" + JSON.stringify(error));\r\n              showToast(parentUpdatePhotoError[languageCode], 5000, toastTypes.ERROR);\r\n              restorePhoto();\r\n              this_.enableButtonsWhileUpdating();\r\n            });\r\n          });\r\n        })\r\n        .catch((error) => {\r\n          console.log(\"Photo upload failed: \" + JSON.stringify(error));\r\n          showToast(parentUpdatePhotoError[languageCode], 5000, toastTypes.ERROR);\r\n          this_.restoreOriginalPhoto();\r\n          this_.enableButtonsWhileUpdating();\r\n        });\r\n    }\r\n\r\n  }\r\n\r\n\r\n  handleChangePhoto(e) {\r\n    const imageFile = e.target.files[0];\r\n    if(imageFile!=null){\r\n      const imageTempUrl = URL.createObjectURL(imageFile);\r\n      this.setState({fileToUpload : imageFile, newPhoto : imageTempUrl});\r\n    }\r\n  }\r\n\r\n\r\n  showModal() {\r\n    this.enableButtonsWhileUpdating();\r\n    this.setState({ show: true });\r\n  }\r\n\r\n  closeModal() {\r\n    this.restoreOriginalPhoto();\r\n    this.setState({ show: false });\r\n    this.enableButtonsWhileUpdating();\r\n  }\r\n\r\n  closeModalAfterUpdate() {\r\n    this.setState({ show: false , fileToUpload : null});\r\n    this.enableButtonsWhileUpdating();\r\n  }\r\n\r\n\r\n  restoreOriginalPhoto() {\r\n    const originalPhoto = this.state.originalPhoto;\r\n    this.setState({ newPhoto: originalPhoto });\r\n  }\r\n\r\n\r\n  setNewPhoto(newPhotoURL){\r\n    this.setState({ originalPhoto: newPhotoURL });\r\n    this.setState({ newPhoto: newPhotoURL });\r\n  }\r\n\r\n  disableButtonsWhileUpdating(){\r\n    this.setState({ onSavePhotoButtonsDisabled: true });\r\n  }\r\n\r\n  enableButtonsWhileUpdating(){\r\n    this.setState({ onSavePhotoButtonsDisabled: false });\r\n  }\r\n\r\n\r\n  render() {\r\n    //console.log(\"state a render -> \" + JSON.stringify(this.state));\r\n    return (\r\n      <>\r\n        <Button\r\n          size=\"sm\"\r\n          theme=\"light\"\r\n          id=\"new_case\"\r\n          onClick={this.showModal}\r\n        >\r\n          <span className=\"material-icons md-24\">add_a_photo</span>\r\n        </Button>\r\n\r\n\r\n        <Modal show={this.state.show} onHide={this.closeModal}>\r\n          <Modal.Header closeButton>\r\n            <Modal.Title>\r\n              {newProfilePhoto[languageCode]}\r\n            </Modal.Title>\r\n          </Modal.Header>\r\n          <Modal.Body>\r\n            <Col>\r\n              <Row\r\n                style={{\r\n                  justifyContent: \"center\",\r\n                  flexDirection: \"column\",\r\n                  alignItems: \"center\",\r\n                }}\r\n              >\r\n                <div style={{\r\n                  width : \"110px\",\r\n                  height: \"110px\",\r\n                  backgroundImage: \"url(\" + this.state.newPhoto + \")\",\r\n                  backgroundPosition : \"center\",\r\n                  borderRadius: \"50%\",\r\n                  backgroundSize: \"cover\",\r\n                  backgroundRepeat: \"no-repeat\"\r\n                }}>\r\n                </div>\r\n                {/*\r\n                  <img\r\n                    className=\"rounded-circle img-fluid\"\r\n                    src={\r\n                      this.state.newPhoto\r\n                    }\r\n                    width=\"110\"\r\n                  />\r\n                */}\r\n              </Row>\r\n              <div style={{ margin: \"10px\" }} />\r\n              <Row\r\n                style={{\r\n                  justifyContent: \"center\",\r\n                  flexDirection: \"column\",\r\n                  alignItems: \"center\",\r\n                }}\r\n              >\r\n                <Row style={{justifyContent: \"center\", alignItems: \"center\", marginBottom: \"5px\"}}>\r\n                  <Button\r\n                    size=\"sm\"\r\n                    theme=\"light\"\r\n                    id=\"add-photo-button\"\r\n                    disabled={this.state.onSavePhotoButtonsDisabled}\r\n                  >\r\n                    <label htmlFor=\"file-upload-input\" style={{cursor: \"pointer\", padding:\"0px\", margin : \"0px\"}}>\r\n                      <span className=\"material-icons md-24\">add_a_photo</span>\r\n                    </label>\r\n                  </Button>\r\n                  <input\r\n                    id=\"file-upload-input\"\r\n                    type=\"file\"\r\n                    accept=\"image/png, image/jpeg\"\r\n                    style={{display: \"none\", margin: \"0px\"}}\r\n                    onChange={this.handleChangePhoto}\r\n                    disabled={this.state.onSavePhotoButtonsDisabled}/>\r\n                </Row>\r\n              </Row>\r\n            </Col>\r\n          </Modal.Body>\r\n\r\n          <Modal.Footer\r\n            style={{ justifyContent: \"left\", flexDirection: \"column\" }}\r\n          >\r\n            <Row>\r\n              <Button style={{marginRight:\"40px\"}} theme=\"danger\" onClick={this.closeModal} disabled={this.state.onSavePhotoButtonsDisabled}>\r\n                {cancel[languageCode]}\r\n              </Button>\r\n              <Button style={{marginLeft:\"40px\"}} className=\"float-right\" theme=\"success\" onClick={this.updatePhoto} disabled={this.state.onSavePhotoButtonsDisabled}>\r\n                {saveChanges[languageCode]}\r\n              </Button>\r\n            </Row>\r\n          </Modal.Footer>\r\n        </Modal>\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport default ParentPhotoModal;\r\n"]},"metadata":{},"sourceType":"module"}