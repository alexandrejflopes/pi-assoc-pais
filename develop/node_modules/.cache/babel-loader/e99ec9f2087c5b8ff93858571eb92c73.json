{"ast":null,"code":"import _defineProperty from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";\nvar _jsxFileName = \"C:\\\\Users\\\\User\\\\Desktop\\\\Ambiente de Trabalho\\\\Universidade\\\\Ano 3\\\\Semestre 2\\\\PI\\\\Projeto\\\\repos\\\\pi-assoc-pais\\\\develop\\\\src\\\\components\\\\profile\\\\AssocLogoModal.js\";\n\n/* eslint jsx-a11y/anchor-is-valid: 0 */\nimport React, { Component as SidebarMainNavbar } from \"react\";\nimport Modal from \"react-bootstrap/Modal\";\nimport { Button, Col, Row } from \"shards-react\";\nimport { assocParameters, defaultAvatar, languageCode, parentsParameters, showToast, toastTypes } from \"../../utils/general_utils\";\nimport { cancel, saveChanges } from \"../../utils/common_strings\";\nimport { newAssocLogoModalTitle, newProfilePhoto } from \"../../utils/page_titles_strings\";\nimport { updateParent, uploadAssocLogo, uploadProfilePhoto } from \"../../firebase_scripts/profile_functions\";\nimport { assocDataUpdateSuccess, assocUpdateLogoError, assocUpdateLogoSuccess, parentUpdatePhotoError, parentUpdatePhotoSuccess } from \"../../utils/messages_strings\";\nimport { firebase_auth, storage, storageRef } from \"../../firebase-config\";\nimport { getAssocDoc, updateAssocDoc } from \"../../firebase_scripts/get_assoc_info\";\n\nvar AssocLogoModal = /*#__PURE__*/function (_React$Component) {\n  _inherits(AssocLogoModal, _React$Component);\n\n  var _super = _createSuper(AssocLogoModal);\n\n  function AssocLogoModal(props) {\n    var _this;\n\n    _classCallCheck(this, AssocLogoModal);\n\n    _this = _super.call(this, props);\n    _this.state = {\n      show: false,\n      newPhoto: _this.props.photo,\n      originalPhoto: _this.props.photo,\n      fileToUpload: null,\n      onSavePhotoButtonsDisabled: false\n    };\n    _this.showModal = _this.showModal.bind(_assertThisInitialized(_this));\n    _this.closeModal = _this.closeModal.bind(_assertThisInitialized(_this));\n    _this.handleChangePhoto = _this.handleChangePhoto.bind(_assertThisInitialized(_this));\n    _this.restoreOriginalPhoto = _this.restoreOriginalPhoto.bind(_assertThisInitialized(_this));\n    _this.closeModalAfterUpdate = _this.closeModalAfterUpdate.bind(_assertThisInitialized(_this));\n    _this.updatePhoto = _this.updatePhoto.bind(_assertThisInitialized(_this));\n    _this.setNewPhoto = _this.setNewPhoto.bind(_assertThisInitialized(_this));\n    _this.enableButtonsWhileUpdating = _this.enableButtonsWhileUpdating.bind(_assertThisInitialized(_this));\n    _this.disableButtonsWhileUpdating = _this.disableButtonsWhileUpdating.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n\n  _createClass(AssocLogoModal, [{\n    key: \"updatePhoto\",\n    value: function updatePhoto() {\n      var _this2 = this;\n\n      var this_ = this;\n      this_.disableButtonsWhileUpdating(); //console.log(\"state antes do update: \" + JSON.stringify(this.state));\n      // if the photo is the same, do nothing\n\n      if (this.state.newPhoto === this_.state.originalPhoto) {\n        this.closeModal();\n        return;\n      }\n\n      var originalPhotoURL = this_.state.originalPhoto;\n      var newPhotoFile = this_.state.fileToUpload;\n      var closeModalAfterTheUpdate = this_.closeModalAfterUpdate;\n      var myComponentDidMount = this_.props.componentDidMount;\n      var setNewPhotoOnState = this_.setNewPhoto;\n      var restorePhoto = this_.restoreOriginalPhoto;\n      /*\r\n      * this will catch the error of trying to get the reference for the\r\n      * defaultPhoto reference, which does not exist\r\n      * */\n\n      try {\n        var previousPhotoRef = storage.refFromURL(originalPhotoURL); // delete current photo to save the new and not cluttering the storage\n\n        previousPhotoRef.delete().then(function () {\n          var uploadTask = uploadAssocLogo(newPhotoFile);\n          uploadTask.then(function (snapshot) {\n            // Handle successful uploads on complete\n            // get the download URL\n            snapshot.ref.getDownloadURL().then(function (downloadURL) {\n              var newLogoField = _defineProperty({}, assocParameters.LOGO[languageCode], downloadURL);\n\n              updateAssocDoc(newLogoField).then(function () {\n                getAssocDoc().then(function (doc) {\n                  if (!doc.exists) {\n                    console.log('No assotiation document found!');\n                  } else {\n                    var assocDataString = JSON.stringify(doc.data());\n                    console.log(\"assocData recebida depois do update foto -> \" + assocDataString); // update assoc data in localstorage\n\n                    window.localStorage.setItem(\"assocDoc\", assocDataString);\n                    closeModalAfterTheUpdate();\n                    myComponentDidMount(true);\n                    setNewPhotoOnState(downloadURL); // TODO: update navbar instantaneously with logo\n\n                    showToast(assocUpdateLogoSuccess[languageCode], 5000, toastTypes.SUCCESS);\n                  }\n                }).catch(function (err) {\n                  console.log('Error getting document', err);\n                });\n              }).catch(function (error) {\n                if (Object.keys(error).length !== 0) {\n                  console.log(\"update error: \" + JSON.stringify(error));\n                  showToast(assocUpdateLogoError[languageCode], 5000, toastTypes.ERROR);\n                  restorePhoto();\n                  this_.enableButtonsWhileUpdating();\n                }\n              });\n            });\n          }).catch(function (error) {\n            console.log(\"Logo upload failed: \" + JSON.stringify(error));\n            showToast(assocUpdateLogoError[languageCode], 5000, toastTypes.ERROR);\n            this_.restoreOriginalPhoto();\n            this_.enableButtonsWhileUpdating();\n          });\n        }).catch(function () {\n          console.log(\"erro no delete\");\n          showToast(assocUpdateLogoError[languageCode], 5000, toastTypes.ERROR);\n\n          _this2.restoreOriginalPhoto();\n\n          this_.enableButtonsWhileUpdating();\n        });\n      } catch (e) {\n        var uploadTask = uploadAssocLogo(newPhotoFile);\n        uploadTask.then(function (snapshot) {\n          // Handle successful uploads on complete\n          // get the download URL\n          snapshot.ref.getDownloadURL().then(function (downloadURL) {\n            var newLogoField = _defineProperty({}, assocParameters.LOGO[languageCode], downloadURL);\n\n            updateAssocDoc(newLogoField).then(function () {\n              getAssocDoc().then(function (doc) {\n                if (!doc.exists) {\n                  console.log('No assotiation document found!');\n                } else {\n                  var assocDataString = JSON.stringify(doc.data());\n                  console.log(\"assocData recebida depois do update foto -> \" + assocDataString); // update assoc data in localstorage\n\n                  window.localStorage.setItem(\"assocDoc\", assocDataString);\n                  closeModalAfterTheUpdate();\n                  myComponentDidMount(true);\n                  setNewPhotoOnState(downloadURL); // TODO: update navbar instantaneously with logo\n\n                  showToast(assocUpdateLogoSuccess[languageCode], 5000, toastTypes.SUCCESS);\n                }\n              }).catch(function (err) {\n                console.log('Error getting document', err);\n              });\n            }).catch(function (error) {\n              if (Object.keys(error).length !== 0) {\n                console.log(\"update error: \" + JSON.stringify(error));\n                showToast(assocUpdateLogoError[languageCode], 5000, toastTypes.ERROR);\n                restorePhoto();\n                this_.enableButtonsWhileUpdating();\n              }\n            });\n          });\n        }).catch(function (error) {\n          console.log(\"Logo upload failed: \" + JSON.stringify(error));\n          showToast(assocUpdateLogoError[languageCode], 5000, toastTypes.ERROR);\n          this_.restoreOriginalPhoto();\n          this_.enableButtonsWhileUpdating();\n        });\n      }\n    }\n  }, {\n    key: \"handleChangePhoto\",\n    value: function handleChangePhoto(e) {\n      var imageFile = e.target.files[0];\n\n      if (imageFile != null) {\n        var imageTempUrl = URL.createObjectURL(imageFile);\n        this.setState({\n          fileToUpload: imageFile,\n          newPhoto: imageTempUrl\n        });\n      }\n    }\n  }, {\n    key: \"showModal\",\n    value: function showModal() {\n      this.enableButtonsWhileUpdating();\n      this.setState({\n        show: true\n      });\n    }\n  }, {\n    key: \"closeModal\",\n    value: function closeModal() {\n      this.restoreOriginalPhoto();\n      this.setState({\n        show: false\n      });\n      this.enableButtonsWhileUpdating();\n    }\n  }, {\n    key: \"closeModalAfterUpdate\",\n    value: function closeModalAfterUpdate() {\n      this.setState({\n        show: false,\n        fileToUpload: null\n      });\n      this.enableButtonsWhileUpdating();\n    }\n  }, {\n    key: \"restoreOriginalPhoto\",\n    value: function restoreOriginalPhoto() {\n      var originalPhoto = this.state.originalPhoto;\n      this.setState({\n        newPhoto: originalPhoto\n      });\n    }\n  }, {\n    key: \"setNewPhoto\",\n    value: function setNewPhoto(newPhotoURL) {\n      this.setState({\n        originalPhoto: newPhotoURL\n      });\n      this.setState({\n        newPhoto: newPhotoURL\n      });\n    }\n  }, {\n    key: \"disableButtonsWhileUpdating\",\n    value: function disableButtonsWhileUpdating() {\n      this.setState({\n        onSavePhotoButtonsDisabled: true\n      });\n    }\n  }, {\n    key: \"enableButtonsWhileUpdating\",\n    value: function enableButtonsWhileUpdating() {\n      this.setState({\n        onSavePhotoButtonsDisabled: false\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Button, {\n        size: \"sm\",\n        theme: \"light\",\n        id: \"new_logo\",\n        onClick: this.showModal,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 250,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        className: \"material-icons md-24\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 11\n        }\n      }, \"add_a_photo\")), /*#__PURE__*/React.createElement(Modal, {\n        show: this.state.show,\n        onHide: this.closeModal,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 260,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(Modal.Header, {\n        closeButton: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 261,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(Modal.Title, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 262,\n          columnNumber: 13\n        }\n      }, newAssocLogoModalTitle[languageCode])), /*#__PURE__*/React.createElement(Modal.Body, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 266,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(Col, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 267,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(Row, {\n        style: {\n          justifyContent: \"center\",\n          flexDirection: \"column\",\n          alignItems: \"center\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 268,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          width: \"100%\",\n          height: \"110px\",\n          backgroundImage: \"url(\" + this.state.newPhoto + \")\",\n          backgroundPosition: \"center\",\n          borderRadius: \"2%\",\n          backgroundSize: \"contain\",\n          backgroundRepeat: \"no-repeat\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 275,\n          columnNumber: 17\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          margin: \"10px\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 286,\n          columnNumber: 15\n        }\n      }), /*#__PURE__*/React.createElement(Row, {\n        style: {\n          justifyContent: \"center\",\n          flexDirection: \"column\",\n          alignItems: \"center\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 287,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(Row, {\n        style: {\n          justifyContent: \"center\",\n          alignItems: \"center\",\n          marginBottom: \"5px\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 294,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        size: \"sm\",\n        theme: \"light\",\n        id: \"add-photo-button\",\n        disabled: this.state.onSavePhotoButtonsDisabled,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 295,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        htmlFor: \"file-upload-input\",\n        style: {\n          cursor: \"pointer\",\n          padding: \"0px\",\n          margin: \"0px\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 301,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        className: \"material-icons md-24\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 302,\n          columnNumber: 23\n        }\n      }, \"add_a_photo\"))), /*#__PURE__*/React.createElement(\"input\", {\n        id: \"file-upload-input\",\n        type: \"file\",\n        accept: \"image/png, image/jpeg\",\n        style: {\n          display: \"none\",\n          margin: \"0px\"\n        },\n        onChange: this.handleChangePhoto,\n        disabled: this.state.onSavePhotoButtonsDisabled,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 305,\n          columnNumber: 19\n        }\n      }))))), /*#__PURE__*/React.createElement(Modal.Footer, {\n        style: {\n          justifyContent: \"left\",\n          flexDirection: \"column\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 317,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(Row, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 320,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        style: {\n          marginRight: \"40px\"\n        },\n        theme: \"danger\",\n        onClick: this.closeModal,\n        disabled: this.state.onSavePhotoButtonsDisabled,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 321,\n          columnNumber: 15\n        }\n      }, cancel[languageCode]), /*#__PURE__*/React.createElement(Button, {\n        style: {\n          marginLeft: \"40px\"\n        },\n        className: \"float-right\",\n        theme: \"success\",\n        onClick: this.updatePhoto,\n        disabled: this.state.onSavePhotoButtonsDisabled,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 324,\n          columnNumber: 15\n        }\n      }, saveChanges[languageCode])))));\n    }\n  }]);\n\n  return AssocLogoModal;\n}(React.Component);\n\nexport default AssocLogoModal;","map":{"version":3,"sources":["C:/Users/User/Desktop/Ambiente de Trabalho/Universidade/Ano 3/Semestre 2/PI/Projeto/repos/pi-assoc-pais/develop/src/components/profile/AssocLogoModal.js"],"names":["React","Component","SidebarMainNavbar","Modal","Button","Col","Row","assocParameters","defaultAvatar","languageCode","parentsParameters","showToast","toastTypes","cancel","saveChanges","newAssocLogoModalTitle","newProfilePhoto","updateParent","uploadAssocLogo","uploadProfilePhoto","assocDataUpdateSuccess","assocUpdateLogoError","assocUpdateLogoSuccess","parentUpdatePhotoError","parentUpdatePhotoSuccess","firebase_auth","storage","storageRef","getAssocDoc","updateAssocDoc","AssocLogoModal","props","state","show","newPhoto","photo","originalPhoto","fileToUpload","onSavePhotoButtonsDisabled","showModal","bind","closeModal","handleChangePhoto","restoreOriginalPhoto","closeModalAfterUpdate","updatePhoto","setNewPhoto","enableButtonsWhileUpdating","disableButtonsWhileUpdating","this_","originalPhotoURL","newPhotoFile","closeModalAfterTheUpdate","myComponentDidMount","componentDidMount","setNewPhotoOnState","restorePhoto","previousPhotoRef","refFromURL","delete","then","uploadTask","snapshot","ref","getDownloadURL","downloadURL","newLogoField","LOGO","doc","exists","console","log","assocDataString","JSON","stringify","data","window","localStorage","setItem","SUCCESS","catch","err","error","Object","keys","length","ERROR","e","imageFile","target","files","imageTempUrl","URL","createObjectURL","setState","newPhotoURL","justifyContent","flexDirection","alignItems","width","height","backgroundImage","backgroundPosition","borderRadius","backgroundSize","backgroundRepeat","margin","marginBottom","cursor","padding","display","marginRight","marginLeft"],"mappings":"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","sourcesContent":["/* eslint jsx-a11y/anchor-is-valid: 0 */\r\n\r\nimport React, {Component as SidebarMainNavbar} from \"react\";\r\nimport Modal from \"react-bootstrap/Modal\";\r\nimport {\r\n  Button,\r\n  Col,\r\n  Row,\r\n} from \"shards-react\";\r\nimport {\r\n  assocParameters,\r\n  defaultAvatar,\r\n  languageCode, parentsParameters, showToast,\r\n  toastTypes,\r\n} from \"../../utils/general_utils\";\r\nimport {\r\n  cancel,\r\n  saveChanges\r\n} from \"../../utils/common_strings\";\r\nimport {\r\n  newAssocLogoModalTitle,\r\n  newProfilePhoto\r\n} from \"../../utils/page_titles_strings\";\r\nimport {\r\n  updateParent, uploadAssocLogo,\r\n  uploadProfilePhoto\r\n} from \"../../firebase_scripts/profile_functions\";\r\nimport {\r\n  assocDataUpdateSuccess, assocUpdateLogoError, assocUpdateLogoSuccess,\r\n  parentUpdatePhotoError, parentUpdatePhotoSuccess,\r\n} from \"../../utils/messages_strings\";\r\nimport {firebase_auth, storage, storageRef} from \"../../firebase-config\";\r\nimport {\r\n  getAssocDoc,\r\n  updateAssocDoc\r\n} from \"../../firebase_scripts/get_assoc_info\";\r\n\r\nclass AssocLogoModal extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      show: false,\r\n      newPhoto : this.props.photo,\r\n      originalPhoto : this.props.photo,\r\n      fileToUpload : null,\r\n      onSavePhotoButtonsDisabled : false\r\n    };\r\n\r\n    this.showModal = this.showModal.bind(this);\r\n    this.closeModal = this.closeModal.bind(this);\r\n    this.handleChangePhoto = this.handleChangePhoto.bind(this);\r\n    this.restoreOriginalPhoto = this.restoreOriginalPhoto.bind(this);\r\n    this.closeModalAfterUpdate = this.closeModalAfterUpdate.bind(this);\r\n    this.updatePhoto = this.updatePhoto.bind(this);\r\n    this.setNewPhoto = this.setNewPhoto.bind(this);\r\n\r\n    this.enableButtonsWhileUpdating = this.enableButtonsWhileUpdating.bind(this);\r\n    this.disableButtonsWhileUpdating = this.disableButtonsWhileUpdating.bind(this);\r\n\r\n  }\r\n\r\n  updatePhoto(){\r\n    const this_ = this;\r\n    this_.disableButtonsWhileUpdating();\r\n    //console.log(\"state antes do update: \" + JSON.stringify(this.state));\r\n\r\n    // if the photo is the same, do nothing\r\n    if(this.state.newPhoto===this_.state.originalPhoto){\r\n      this.closeModal();\r\n      return;\r\n    }\r\n\r\n    const originalPhotoURL = this_.state.originalPhoto;\r\n    const newPhotoFile = this_.state.fileToUpload;\r\n\r\n    const closeModalAfterTheUpdate = this_.closeModalAfterUpdate;\r\n    const myComponentDidMount = this_.props.componentDidMount;\r\n    const setNewPhotoOnState = this_.setNewPhoto;\r\n    const restorePhoto = this_.restoreOriginalPhoto;\r\n\r\n    /*\r\n    * this will catch the error of trying to get the reference for the\r\n    * defaultPhoto reference, which does not exist\r\n    * */\r\n    try{\r\n      let previousPhotoRef = storage.refFromURL(originalPhotoURL);\r\n      // delete current photo to save the new and not cluttering the storage\r\n      previousPhotoRef.delete()\r\n        .then(() => {\r\n          const uploadTask = uploadAssocLogo(newPhotoFile);\r\n          uploadTask\r\n            .then((snapshot) => {\r\n              // Handle successful uploads on complete\r\n              // get the download URL\r\n              snapshot.ref.getDownloadURL().then(function (downloadURL) {\r\n                const newLogoField = {[assocParameters.LOGO[languageCode]] : downloadURL};\r\n\r\n                updateAssocDoc(newLogoField)\r\n                  .then(() => {\r\n                    getAssocDoc()\r\n                      .then(doc => {\r\n                        if (!doc.exists) {\r\n                          console.log('No assotiation document found!');\r\n                        }\r\n                        else {\r\n                          const assocDataString = JSON.stringify(doc.data());\r\n                          console.log(\"assocData recebida depois do update foto -> \" + assocDataString);\r\n                          // update assoc data in localstorage\r\n                          window.localStorage.setItem(\"assocDoc\", assocDataString);\r\n                          closeModalAfterTheUpdate();\r\n                          myComponentDidMount(true);\r\n                          setNewPhotoOnState(downloadURL);\r\n                          // TODO: update navbar instantaneously with logo\r\n                          showToast(assocUpdateLogoSuccess[languageCode], 5000, toastTypes.SUCCESS);\r\n                        }\r\n                      })\r\n                      .catch(err => {\r\n                        console.log('Error getting document', err);\r\n                      });\r\n                  })\r\n                  .catch((error) => {\r\n                    if(Object.keys(error).length!==0){\r\n                      console.log(\"update error: \" + JSON.stringify(error));\r\n                      showToast(assocUpdateLogoError[languageCode], 5000, toastTypes.ERROR);\r\n                      restorePhoto();\r\n                      this_.enableButtonsWhileUpdating();\r\n                    }\r\n                  });\r\n\r\n              });\r\n            })\r\n            .catch((error) => {\r\n              console.log(\"Logo upload failed: \" + JSON.stringify(error));\r\n              showToast(assocUpdateLogoError[languageCode], 5000, toastTypes.ERROR);\r\n              this_.restoreOriginalPhoto();\r\n              this_.enableButtonsWhileUpdating();\r\n            });\r\n        })\r\n        .catch(() => {\r\n          console.log(\"erro no delete\");\r\n          showToast(assocUpdateLogoError[languageCode], 5000, toastTypes.ERROR);\r\n          this.restoreOriginalPhoto();\r\n          this_.enableButtonsWhileUpdating();\r\n        });\r\n    }\r\n    catch (e) {\r\n      const uploadTask = uploadAssocLogo(newPhotoFile);\r\n      uploadTask\r\n        .then((snapshot) => {\r\n          // Handle successful uploads on complete\r\n          // get the download URL\r\n          snapshot.ref.getDownloadURL().then(function (downloadURL) {\r\n            const newLogoField = {[assocParameters.LOGO[languageCode]] : downloadURL};\r\n\r\n            updateAssocDoc(newLogoField)\r\n              .then(() => {\r\n                getAssocDoc()\r\n                  .then(doc => {\r\n                    if (!doc.exists) {\r\n                      console.log('No assotiation document found!');\r\n                    }\r\n                    else {\r\n                      const assocDataString = JSON.stringify(doc.data());\r\n                      console.log(\"assocData recebida depois do update foto -> \" + assocDataString);\r\n                      // update assoc data in localstorage\r\n                      window.localStorage.setItem(\"assocDoc\", assocDataString);\r\n                      closeModalAfterTheUpdate();\r\n                      myComponentDidMount(true);\r\n                      setNewPhotoOnState(downloadURL);\r\n                      // TODO: update navbar instantaneously with logo\r\n                      showToast(assocUpdateLogoSuccess[languageCode], 5000, toastTypes.SUCCESS);\r\n                    }\r\n                  })\r\n                  .catch(err => {\r\n                    console.log('Error getting document', err);\r\n                  });\r\n              })\r\n              .catch((error) => {\r\n                if(Object.keys(error).length!==0){\r\n                  console.log(\"update error: \" + JSON.stringify(error));\r\n                  showToast(assocUpdateLogoError[languageCode], 5000, toastTypes.ERROR);\r\n                  restorePhoto();\r\n                  this_.enableButtonsWhileUpdating();\r\n                }\r\n              });\r\n\r\n          });\r\n        })\r\n        .catch((error) => {\r\n          console.log(\"Logo upload failed: \" + JSON.stringify(error));\r\n          showToast(assocUpdateLogoError[languageCode], 5000, toastTypes.ERROR);\r\n          this_.restoreOriginalPhoto();\r\n          this_.enableButtonsWhileUpdating();\r\n        });\r\n    }\r\n\r\n  }\r\n\r\n\r\n  handleChangePhoto(e) {\r\n    const imageFile = e.target.files[0];\r\n    if(imageFile!=null){\r\n      const imageTempUrl = URL.createObjectURL(imageFile);\r\n      this.setState({fileToUpload : imageFile, newPhoto : imageTempUrl});\r\n    }\r\n  }\r\n\r\n\r\n  showModal() {\r\n    this.enableButtonsWhileUpdating();\r\n    this.setState({ show: true });\r\n  }\r\n\r\n  closeModal() {\r\n    this.restoreOriginalPhoto();\r\n    this.setState({ show: false });\r\n    this.enableButtonsWhileUpdating();\r\n  }\r\n\r\n  closeModalAfterUpdate() {\r\n    this.setState({ show: false , fileToUpload : null});\r\n    this.enableButtonsWhileUpdating();\r\n  }\r\n\r\n\r\n  restoreOriginalPhoto() {\r\n    const originalPhoto = this.state.originalPhoto;\r\n    this.setState({ newPhoto: originalPhoto });\r\n  }\r\n\r\n\r\n  setNewPhoto(newPhotoURL){\r\n    this.setState({ originalPhoto: newPhotoURL });\r\n    this.setState({ newPhoto: newPhotoURL });\r\n  }\r\n\r\n  disableButtonsWhileUpdating(){\r\n    this.setState({ onSavePhotoButtonsDisabled: true });\r\n  }\r\n\r\n  enableButtonsWhileUpdating(){\r\n    this.setState({ onSavePhotoButtonsDisabled: false });\r\n  }\r\n\r\n\r\n  render() {\r\n    return (\r\n      <>\r\n        <Button\r\n          size=\"sm\"\r\n          theme=\"light\"\r\n          id=\"new_logo\"\r\n          onClick={this.showModal}\r\n        >\r\n          <span className=\"material-icons md-24\">add_a_photo</span>\r\n        </Button>\r\n\r\n\r\n        <Modal show={this.state.show} onHide={this.closeModal}>\r\n          <Modal.Header closeButton>\r\n            <Modal.Title>\r\n              {newAssocLogoModalTitle[languageCode]}\r\n            </Modal.Title>\r\n          </Modal.Header>\r\n          <Modal.Body>\r\n            <Col>\r\n              <Row\r\n                style={{\r\n                  justifyContent: \"center\",\r\n                  flexDirection: \"column\",\r\n                  alignItems: \"center\",\r\n                }}\r\n              >\r\n                <div style={{\r\n                  width : \"100%\",\r\n                  height: \"110px\",\r\n                  backgroundImage: \"url(\" + this.state.newPhoto + \")\",\r\n                  backgroundPosition : \"center\",\r\n                  borderRadius: \"2%\",\r\n                  backgroundSize: \"contain\",\r\n                  backgroundRepeat: \"no-repeat\",\r\n                }}>\r\n                </div>\r\n              </Row>\r\n              <div style={{ margin: \"10px\" }} />\r\n              <Row\r\n                style={{\r\n                  justifyContent: \"center\",\r\n                  flexDirection: \"column\",\r\n                  alignItems: \"center\",\r\n                }}\r\n              >\r\n                <Row style={{justifyContent: \"center\", alignItems: \"center\", marginBottom: \"5px\"}}>\r\n                  <Button\r\n                    size=\"sm\"\r\n                    theme=\"light\"\r\n                    id=\"add-photo-button\"\r\n                    disabled={this.state.onSavePhotoButtonsDisabled}\r\n                  >\r\n                    <label htmlFor=\"file-upload-input\" style={{cursor: \"pointer\", padding:\"0px\", margin : \"0px\"}}>\r\n                      <span className=\"material-icons md-24\">add_a_photo</span>\r\n                    </label>\r\n                  </Button>\r\n                  <input\r\n                    id=\"file-upload-input\"\r\n                    type=\"file\"\r\n                    accept=\"image/png, image/jpeg\"\r\n                    style={{display: \"none\", margin: \"0px\"}}\r\n                    onChange={this.handleChangePhoto}\r\n                    disabled={this.state.onSavePhotoButtonsDisabled}/>\r\n                </Row>\r\n              </Row>\r\n            </Col>\r\n          </Modal.Body>\r\n\r\n          <Modal.Footer\r\n            style={{ justifyContent: \"left\", flexDirection: \"column\" }}\r\n          >\r\n            <Row>\r\n              <Button style={{marginRight:\"40px\"}} theme=\"danger\" onClick={this.closeModal} disabled={this.state.onSavePhotoButtonsDisabled}>\r\n                {cancel[languageCode]}\r\n              </Button>\r\n              <Button style={{marginLeft:\"40px\"}} className=\"float-right\" theme=\"success\" onClick={this.updatePhoto} disabled={this.state.onSavePhotoButtonsDisabled}>\r\n                {saveChanges[languageCode]}\r\n              </Button>\r\n            </Row>\r\n          </Modal.Footer>\r\n        </Modal>\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport default AssocLogoModal;\r\n"]},"metadata":{},"sourceType":"module"}